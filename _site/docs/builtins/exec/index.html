<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>exec() - ä»£ç æ‰§è¡Œå‡½æ•° - PythonçŸ¥è¯†ä½“ç³»æ–‡æ¡£</title>
  <meta name="description" content="æ‰§è¡Œå­—ç¬¦ä¸²å½¢å¼çš„Pythonä»£ç ">

  <!-- SEOæ ‡ç­¾ -->
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>exec() - ä»£ç æ‰§è¡Œå‡½æ•° | PythonçŸ¥è¯†ä½“ç³»æ–‡æ¡£</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="exec() - ä»£ç æ‰§è¡Œå‡½æ•°" />
<meta name="author" content="Pythonæ–‡æ¡£å·¥ç¨‹å¸ˆ" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="æ‰§è¡Œå­—ç¬¦ä¸²å½¢å¼çš„Pythonä»£ç " />
<meta property="og:description" content="æ‰§è¡Œå­—ç¬¦ä¸²å½¢å¼çš„Pythonä»£ç " />
<link rel="canonical" href="http://0.0.0.0:4000/PythonModelBook/docs/builtins/exec/" />
<meta property="og:url" content="http://0.0.0.0:4000/PythonModelBook/docs/builtins/exec/" />
<meta property="og:site_name" content="PythonçŸ¥è¯†ä½“ç³»æ–‡æ¡£" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-01-15T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="exec() - ä»£ç æ‰§è¡Œå‡½æ•°" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Pythonæ–‡æ¡£å·¥ç¨‹å¸ˆ"},"dateModified":"2024-01-15T00:00:00+08:00","datePublished":"2024-01-15T00:00:00+08:00","description":"æ‰§è¡Œå­—ç¬¦ä¸²å½¢å¼çš„Pythonä»£ç ","headline":"exec() - ä»£ç æ‰§è¡Œå‡½æ•°","mainEntityOfPage":{"@type":"WebPage","@id":"http://0.0.0.0:4000/PythonModelBook/docs/builtins/exec/"},"url":"http://0.0.0.0:4000/PythonModelBook/docs/builtins/exec/"}</script>
<!-- End Jekyll SEO tag -->


  <!-- æ ·å¼æ–‡ä»¶ -->
  <link rel="stylesheet" href="/PythonModelBook/assets/css/main.css">
  <link rel="stylesheet" href="/PythonModelBook/assets/css/light-theme.css">
  <link rel="stylesheet" href="/PythonModelBook/assets/css/dark-theme.css">

  <!-- å­—ä½“ -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- å›¾æ ‡ -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

  <!-- æœç´¢åŠŸèƒ½ -->
  <script src="https://unpkg.com/lunr/lunr.js"></script>
</head>

<body>
  <!-- å¯¼èˆªæ  -->
  <nav class="navbar">
    <div class="nav-container">
      <div class="nav-brand">
        <a href="/PythonModelBook/" class="brand-link">
          <i class="fab fa-python"></i>
          <span>PythonçŸ¥è¯†ä½“ç³»æ–‡æ¡£</span>
        </a>
      </div>

      <!-- æœç´¢æ¡† -->
      <div class="nav-search">
        <div class="search-container">
          <input type="text" id="search-input" placeholder="æœç´¢æ–‡æ¡£..." class="search-input">
          <i class="fas fa-search search-icon"></i>
          <div id="search-results" class="search-results"></div>
        </div>
      </div>

      <!-- å¯¼èˆªèœå• -->
      <div class="nav-menu">
        <a href="/PythonModelBook/" class="nav-link">é¦–é¡µ</a>
        <a href="/PythonModelBook/docs/" class="nav-link">æ–‡æ¡£</a>
        <a href="/PythonModelBook/about/" class="nav-link">å…³äº</a>
        <button id="theme-toggle" class="theme-toggle" title="åˆ‡æ¢ä¸»é¢˜">
          <i class="fas fa-moon"></i>
        </button>
      </div>

      <!-- ç§»åŠ¨ç«¯èœå•æŒ‰é’® -->
      <button class="mobile-menu-btn" id="mobile-menu-btn">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </nav>

  <!-- ä¸»è¦å†…å®¹ -->
  <main class="main-content">
    <div class="doc-container">
  <!-- æ–‡æ¡£å†…å®¹åŒºåŸŸ -->
  <main class="doc-content">
    <article class="doc-article">
      <!-- æ–‡æ¡£å¤´éƒ¨ä¿¡æ¯ -->
      <header class="doc-header">
        <h1 class="doc-title">exec() - ä»£ç æ‰§è¡Œå‡½æ•°</h1>
        
        
        <p class="doc-description">æ‰§è¡Œå­—ç¬¦ä¸²å½¢å¼çš„Pythonä»£ç </p>
        
        
        <div class="doc-meta">
          
          <span class="doc-category">åˆ†ç±»: builtins</span>
          
          
          
          <span class="doc-difficulty">éš¾åº¦: é«˜çº§</span>
          
          
          
          <span class="doc-updated">æ›´æ–°: 2024-01-15</span>
          
        </div>
        
        
        <div class="doc-tags">
          
          <span class="tag">ä»£ç æ‰§è¡Œ</span>
          
          <span class="tag">åŠ¨æ€æ‰§è¡Œ</span>
          
          <span class="tag">è¯­å¥æ‰§è¡Œ</span>
          
          <span class="tag">å®‰å…¨é£é™©</span>
          
        </div>
        
      </header>
      
      <!-- æ–‡æ¡£æ­£æ–‡ -->
      <div class="doc-body">
        <h1 id="exec---ä»£ç æ‰§è¡Œå‡½æ•°">exec() - ä»£ç æ‰§è¡Œå‡½æ•°</h1>

<h2 id="-æ¦‚è¿°">ğŸ“ æ¦‚è¿°</h2>

<p><code class="language-plaintext highlighter-rouge">exec()</code> æ˜¯Pythonä¸­çš„å†…ç½®å‡½æ•°ï¼Œç”¨äºæ‰§è¡Œå­—ç¬¦ä¸²å½¢å¼çš„Pythonä»£ç ã€‚ä¸ <code class="language-plaintext highlighter-rouge">eval()</code> ä¸åŒï¼Œ<code class="language-plaintext highlighter-rouge">exec()</code> å¯ä»¥æ‰§è¡Œå®Œæ•´çš„Pythonè¯­å¥ï¼ŒåŒ…æ‹¬èµ‹å€¼ã€å¾ªç¯ã€å‡½æ•°å®šä¹‰ã€ç±»å®šä¹‰ç­‰ã€‚è¿™ä¸ªå‡½æ•°æä¾›äº†å¼ºå¤§çš„åŠ¨æ€ä»£ç æ‰§è¡Œèƒ½åŠ›ï¼Œä½†åŒæ—¶ä¹Ÿå¸¦æ¥äº†ä¸¥é‡çš„å®‰å…¨é£é™©ã€‚</p>

<h2 id="ï¸-å®‰å…¨è­¦å‘Š">âš ï¸ å®‰å…¨è­¦å‘Š</h2>

<p><strong>exec()å‡½æ•°å­˜åœ¨æé«˜çš„å®‰å…¨é£é™©ï¼</strong></p>
<ul>
  <li>æ°¸è¿œä¸è¦å¯¹ä¸å¯ä¿¡çš„è¾“å…¥ä½¿ç”¨exec()</li>
  <li>æ¶æ„ä»£ç å¯èƒ½å®Œå…¨æ§åˆ¶ç³»ç»Ÿ</li>
  <li>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨æ—¶å¿…é¡»è¿›è¡Œä¸¥æ ¼çš„å®‰å…¨æ§åˆ¶</li>
  <li>è€ƒè™‘ä½¿ç”¨æ›´å®‰å…¨çš„æ›¿ä»£æ–¹æ¡ˆ</li>
</ul>

<h2 id="-å­¦ä¹ ç›®æ ‡">ğŸ¯ å­¦ä¹ ç›®æ ‡</h2>

<ul>
  <li>æŒæ¡exec()å‡½æ•°çš„åŸºæœ¬ç”¨æ³•å’Œè¯­æ³•</li>
  <li>ç†è§£exec()ä¸eval()çš„åŒºåˆ«</li>
  <li>å­¦ä¼šå®‰å…¨åœ°ä½¿ç”¨exec()å‡½æ•°</li>
  <li>äº†è§£exec()çš„åº”ç”¨åœºæ™¯å’Œé™åˆ¶</li>
  <li>æŒæ¡åŠ¨æ€ä»£ç ç”Ÿæˆå’Œæ‰§è¡ŒæŠ€æœ¯</li>
</ul>

<h2 id="-å‰ç½®çŸ¥è¯†">ğŸ“‹ å‰ç½®çŸ¥è¯†</h2>

<ul>
  <li>PythonåŸºæœ¬è¯­æ³•</li>
  <li>è¡¨è¾¾å¼å’Œè¯­å¥çš„åŒºåˆ«</li>
  <li>ä½œç”¨åŸŸå’Œå‘½åç©ºé—´çš„æ¦‚å¿µ</li>
  <li>å¼‚å¸¸å¤„ç†çš„åŸºæœ¬çŸ¥è¯†</li>
  <li>å®‰å…¨ç¼–ç¨‹çš„åŸºæœ¬æ¦‚å¿µ</li>
  <li>é¢å‘å¯¹è±¡ç¼–ç¨‹åŸºç¡€</li>
</ul>

<h2 id="-è¯¦ç»†å†…å®¹">ğŸ” è¯¦ç»†å†…å®¹</h2>

<h3 id="åŸºæœ¬æ¦‚å¿µ">åŸºæœ¬æ¦‚å¿µ</h3>

<p><code class="language-plaintext highlighter-rouge">exec()</code> å‡½æ•°æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°ï¼Œå°†å…¶ä½œä¸ºPythonä»£ç è¿›è¡Œæ‰§è¡Œã€‚å®ƒå¯ä»¥æ‰§è¡Œä»»ä½•æœ‰æ•ˆçš„Pythonè¯­å¥ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
  <li>èµ‹å€¼è¯­å¥</li>
  <li>æ§åˆ¶æµè¯­å¥ï¼ˆifã€forã€whileç­‰ï¼‰</li>
  <li>å‡½æ•°å®šä¹‰</li>
  <li>ç±»å®šä¹‰</li>
  <li>å¯¼å…¥è¯­å¥</li>
  <li>å…¶ä»–å¤æ‚çš„Pythonä»£ç </li>
</ul>

<h3 id="è¯­æ³•æ ¼å¼">è¯­æ³•æ ¼å¼</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">exec</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="nb">globals</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">locals</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="å‚æ•°è¯´æ˜">å‚æ•°è¯´æ˜</h3>

<table>
  <thead>
    <tr>
      <th>å‚æ•°å</th>
      <th>ç±»å‹</th>
      <th>å¿…éœ€</th>
      <th>é»˜è®¤å€¼</th>
      <th>è¯´æ˜</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>object</td>
      <td>å­—ç¬¦ä¸²æˆ–ä»£ç å¯¹è±¡</td>
      <td>æ˜¯</td>
      <td>æ— </td>
      <td>è¦æ‰§è¡Œçš„Pythonä»£ç </td>
    </tr>
    <tr>
      <td>globals</td>
      <td>å­—å…¸</td>
      <td>å¦</td>
      <td>None</td>
      <td>å…¨å±€å‘½åç©ºé—´</td>
    </tr>
    <tr>
      <td>locals</td>
      <td>å­—å…¸</td>
      <td>å¦</td>
      <td>None</td>
      <td>å±€éƒ¨å‘½åç©ºé—´</td>
    </tr>
  </tbody>
</table>

<h3 id="è¿”å›å€¼">è¿”å›å€¼</h3>

<ul>
  <li><strong>ç±»å‹</strong>: None</li>
  <li><strong>è¯´æ˜</strong>: exec()æ€»æ˜¯è¿”å›Noneï¼Œä½†æ‰§è¡Œçš„ä»£ç å¯èƒ½ä¼šä¿®æ”¹å‘½åç©ºé—´</li>
</ul>

<h2 id="-ä»£ç ç¤ºä¾‹">ğŸ’¡ ä»£ç ç¤ºä¾‹</h2>

<h3 id="åŸºæœ¬ç”¨æ³•">åŸºæœ¬ç”¨æ³•</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># åŸºæœ¬è¯­å¥æ‰§è¡Œ
</span><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">åŸºæœ¬è¯­å¥æ‰§è¡Œ:</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># ç®€å•èµ‹å€¼
</span><span class="nf">exec</span><span class="p">(</span><span class="sh">"</span><span class="s">x = 10</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">x = </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># 10
</span>
<span class="c1"># å¤šè¡Œä»£ç 
</span><span class="n">code</span> <span class="o">=</span> <span class="sh">"""</span><span class="s">
y = 20
z = x + y
print(f</span><span class="sh">'</span><span class="s">x + y = {z}</span><span class="sh">'</span><span class="s">)
</span><span class="sh">"""</span>
<span class="nf">exec</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>

<span class="c1"># æ§åˆ¶æµè¯­å¥
</span><span class="n">loop_code</span> <span class="o">=</span> <span class="sh">"""</span><span class="s">
for i in range(3):
    print(f</span><span class="sh">'</span><span class="s">å¾ªç¯ {i}</span><span class="sh">'</span><span class="s">)
</span><span class="sh">"""</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">æ§åˆ¶æµæ‰§è¡Œ:</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">exec</span><span class="p">(</span><span class="n">loop_code</span><span class="p">)</span>

<span class="c1"># æ¡ä»¶è¯­å¥
</span><span class="n">condition_code</span> <span class="o">=</span> <span class="sh">"""</span><span class="s">
if x &gt; 5:
    print(</span><span class="sh">'</span><span class="s">x å¤§äº 5</span><span class="sh">'</span><span class="s">)
else:
    print(</span><span class="sh">'</span><span class="s">x ä¸å¤§äº 5</span><span class="sh">'</span><span class="s">)
</span><span class="sh">"""</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">æ¡ä»¶è¯­å¥æ‰§è¡Œ:</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">exec</span><span class="p">(</span><span class="n">condition_code</span><span class="p">)</span>

<span class="c1"># å‡½æ•°å®šä¹‰å’Œè°ƒç”¨
</span><span class="n">function_code</span> <span class="o">=</span> <span class="sh">"""</span><span class="s">
def greet(name):
    return f</span><span class="sh">'</span><span class="s">Hello, {name}!</span><span class="sh">'</span><span class="s">

message = greet(</span><span class="sh">'</span><span class="s">Python</span><span class="sh">'</span><span class="s">)
print(message)
</span><span class="sh">"""</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">å‡½æ•°å®šä¹‰æ‰§è¡Œ:</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">exec</span><span class="p">(</span><span class="n">function_code</span><span class="p">)</span>

<span class="c1"># ç±»å®šä¹‰
</span><span class="n">class_code</span> <span class="o">=</span> <span class="sh">"""</span><span class="s">
class Person:
    def __init__(self, name, age):
        self.name = name
        self.age = age
    
    def introduce(self):
        return f</span><span class="sh">'</span><span class="s">æˆ‘æ˜¯{self.name}ï¼Œ{self.age}å²</span><span class="sh">'</span><span class="s">

person = Person(</span><span class="sh">'</span><span class="s">å¼ ä¸‰</span><span class="sh">'</span><span class="s">, 25)
print(person.introduce())
</span><span class="sh">"""</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">ç±»å®šä¹‰æ‰§è¡Œ:</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">exec</span><span class="p">(</span><span class="n">class_code</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="ä½¿ç”¨è‡ªå®šä¹‰å‘½åç©ºé—´">ä½¿ç”¨è‡ªå®šä¹‰å‘½åç©ºé—´</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># è‡ªå®šä¹‰å‘½åç©ºé—´ç¤ºä¾‹
</span><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">è‡ªå®šä¹‰å‘½åç©ºé—´ç¤ºä¾‹:</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># åˆ›å»ºéš”ç¦»çš„å…¨å±€å‘½åç©ºé—´
</span><span class="n">custom_globals</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">'</span><span class="s">__builtins__</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span>
        <span class="sh">'</span><span class="s">print</span><span class="sh">'</span><span class="p">:</span> <span class="k">print</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">len</span><span class="sh">'</span><span class="p">:</span> <span class="nb">len</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">range</span><span class="sh">'</span><span class="p">:</span> <span class="nb">range</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">str</span><span class="sh">'</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">int</span><span class="sh">'</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">float</span><span class="sh">'</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">},</span>
    <span class="sh">'</span><span class="s">math_pi</span><span class="sh">'</span><span class="p">:</span> <span class="mf">3.14159</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">math_e</span><span class="sh">'</span><span class="p">:</span> <span class="mf">2.71828</span>
<span class="p">}</span>

<span class="c1"># åˆ›å»ºå±€éƒ¨å‘½åç©ºé—´
</span><span class="n">custom_locals</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># åœ¨è‡ªå®šä¹‰å‘½åç©ºé—´ä¸­æ‰§è¡Œä»£ç 
</span><span class="n">code_with_namespace</span> <span class="o">=</span> <span class="sh">"""</span><span class="s">
# å®šä¹‰ä¸€äº›å˜é‡
radius = 5
area = math_pi * radius ** 2

# å®šä¹‰å‡½æ•°
def calculate_circle_area(r):
    return math_pi * r ** 2

def calculate_volume(r, h):
    base_area = calculate_circle_area(r)
    return base_area * h

# è®¡ç®—ç»“æœ
results = {
    </span><span class="sh">'</span><span class="s">area</span><span class="sh">'</span><span class="s">: area,
    </span><span class="sh">'</span><span class="s">volume</span><span class="sh">'</span><span class="s">: calculate_volume(3, 10)
}

print(f</span><span class="sh">'</span><span class="s">åœ†é¢ç§¯: {area}</span><span class="sh">'</span><span class="s">)
print(f</span><span class="sh">'</span><span class="s">åœ†æŸ±ä½“ç§¯: {results[</span><span class="sh">"</span><span class="s">volume</span><span class="sh">"</span><span class="s">]}</span><span class="sh">'</span><span class="s">)
</span><span class="sh">"""</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">åœ¨è‡ªå®šä¹‰å‘½åç©ºé—´ä¸­æ‰§è¡Œ:</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">exec</span><span class="p">(</span><span class="n">code_with_namespace</span><span class="p">,</span> <span class="n">custom_globals</span><span class="p">,</span> <span class="n">custom_locals</span><span class="p">)</span>

<span class="c1"># æŸ¥çœ‹æ‰§è¡Œåçš„å±€éƒ¨å˜é‡
</span><span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="s">æ‰§è¡Œåçš„å±€éƒ¨å˜é‡:</span><span class="sh">"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">custom_locals</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">'</span><span class="s">__</span><span class="sh">'</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># å°è¯•è®¿é—®è¢«é™åˆ¶çš„åŠŸèƒ½
</span><span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="s">å®‰å…¨æ€§æµ‹è¯•:</span><span class="sh">"</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">restricted_code</span> <span class="o">=</span> <span class="sh">"""</span><span class="s">
import os
os.system(</span><span class="sh">'</span><span class="s">echo </span><span class="sh">"</span><span class="s">è¿™ä¸åº”è¯¥æ‰§è¡Œ</span><span class="sh">"'</span><span class="s">)
</span><span class="sh">"""</span>
    <span class="nf">exec</span><span class="p">(</span><span class="n">restricted_code</span><span class="p">,</span> <span class="n">custom_globals</span><span class="p">,</span> <span class="p">{})</span>
<span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">è®¿é—®å—é™åŠŸèƒ½å¤±è´¥ï¼ˆé¢„æœŸï¼‰: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># åŠ¨æ€å˜é‡è®¿é—®
</span><span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="s">åŠ¨æ€å˜é‡è®¿é—®:</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># ä»å±€éƒ¨å‘½åç©ºé—´è·å–å‡½æ•°
</span><span class="k">if</span> <span class="sh">'</span><span class="s">calculate_circle_area</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">custom_locals</span><span class="p">:</span>
    <span class="n">calc_func</span> <span class="o">=</span> <span class="n">custom_locals</span><span class="p">[</span><span class="sh">'</span><span class="s">calculate_circle_area</span><span class="sh">'</span><span class="p">]</span>
    <span class="n">result</span> <span class="o">=</span> <span class="nf">calc_func</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">åŠ¨æ€è°ƒç”¨å‡½æ•°ç»“æœ: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="åŠ¨æ€ä»£ç ç”Ÿæˆ">åŠ¨æ€ä»£ç ç”Ÿæˆ</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># åŠ¨æ€ä»£ç ç”Ÿæˆç¤ºä¾‹
</span><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">åŠ¨æ€ä»£ç ç”Ÿæˆç¤ºä¾‹:</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># ä»£ç ç”Ÿæˆå™¨ç±»
</span><span class="k">class</span> <span class="nc">CodeGenerator</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">åŠ¨æ€ä»£ç ç”Ÿæˆå™¨</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">indent_level</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">self</span><span class="p">.</span><span class="n">code_lines</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">def</span> <span class="nf">add_line</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">æ·»åŠ ä»£ç è¡Œ</span><span class="sh">"""</span>
        <span class="n">indent</span> <span class="o">=</span> <span class="sh">'</span><span class="s">    </span><span class="sh">'</span> <span class="o">*</span> <span class="n">self</span><span class="p">.</span><span class="n">indent_level</span>
        <span class="n">self</span><span class="p">.</span><span class="n">code_lines</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="n">line</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">indent</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">å¢åŠ ç¼©è¿›</span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="n">indent_level</span> <span class="o">+=</span> <span class="mi">1</span>
    
    <span class="k">def</span> <span class="nf">dedent</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">å‡å°‘ç¼©è¿›</span><span class="sh">"""</span>
        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">indent_level</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">indent_level</span> <span class="o">-=</span> <span class="mi">1</span>
    
    <span class="k">def</span> <span class="nf">get_code</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">è·å–ç”Ÿæˆçš„ä»£ç </span><span class="sh">"""</span>
        <span class="k">return</span> <span class="sh">'</span><span class="se">\n</span><span class="sh">'</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">code_lines</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">æ¸…ç©ºä»£ç </span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="n">code_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">self</span><span class="p">.</span><span class="n">indent_level</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># ç”Ÿæˆæ•°å­¦å‡½æ•°
</span><span class="k">def</span> <span class="nf">generate_math_function</span><span class="p">(</span><span class="n">func_name</span><span class="p">,</span> <span class="n">operations</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">ç”Ÿæˆæ•°å­¦å‡½æ•°</span><span class="sh">"""</span>
    <span class="n">generator</span> <span class="o">=</span> <span class="nc">CodeGenerator</span><span class="p">()</span>
    
    <span class="c1"># å‡½æ•°å®šä¹‰
</span>    <span class="n">generator</span><span class="p">.</span><span class="nf">add_line</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">def </span><span class="si">{</span><span class="n">func_name</span><span class="si">}</span><span class="s">(x):</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">generator</span><span class="p">.</span><span class="nf">indent</span><span class="p">()</span>
    
    <span class="c1"># æ·»åŠ æ“ä½œ
</span>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">op</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">operations</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">generator</span><span class="p">.</span><span class="nf">add_line</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">result = x </span><span class="si">{</span><span class="n">op</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">generator</span><span class="p">.</span><span class="nf">add_line</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">result = result </span><span class="si">{</span><span class="n">op</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="c1"># è¿”å›ç»“æœ
</span>    <span class="n">generator</span><span class="p">.</span><span class="nf">add_line</span><span class="p">(</span><span class="sh">"</span><span class="s">return result</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">generator</span><span class="p">.</span><span class="nf">get_code</span><span class="p">()</span>

<span class="c1"># ç”Ÿæˆå¹¶æ‰§è¡Œæ•°å­¦å‡½æ•°
</span><span class="n">math_operations</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">+ 10</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">* 2</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">- 5</span><span class="sh">'</span><span class="p">]</span>
<span class="n">math_code</span> <span class="o">=</span> <span class="nf">generate_math_function</span><span class="p">(</span><span class="sh">'</span><span class="s">custom_math</span><span class="sh">'</span><span class="p">,</span> <span class="n">math_operations</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">ç”Ÿæˆçš„æ•°å­¦å‡½æ•°ä»£ç :</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">math_code</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">æ‰§è¡Œç”Ÿæˆçš„å‡½æ•°:</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">exec</span><span class="p">(</span><span class="n">math_code</span><span class="p">)</span>

<span class="c1"># æµ‹è¯•ç”Ÿæˆçš„å‡½æ•°
</span><span class="n">test_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span>
<span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">test_values</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="nf">custom_math</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">custom_math(</span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s">) = </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># ç”Ÿæˆç±»å®šä¹‰
</span><span class="k">def</span> <span class="nf">generate_data_class</span><span class="p">(</span><span class="n">class_name</span><span class="p">,</span> <span class="n">fields</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">ç”Ÿæˆæ•°æ®ç±»</span><span class="sh">"""</span>
    <span class="n">generator</span> <span class="o">=</span> <span class="nc">CodeGenerator</span><span class="p">()</span>
    
    <span class="c1"># ç±»å®šä¹‰
</span>    <span class="n">generator</span><span class="p">.</span><span class="nf">add_line</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">class </span><span class="si">{</span><span class="n">class_name</span><span class="si">}</span><span class="s">:</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">generator</span><span class="p">.</span><span class="nf">indent</span><span class="p">()</span>
    
    <span class="c1"># __init__ æ–¹æ³•
</span>    <span class="n">params</span> <span class="o">=</span> <span class="sh">'</span><span class="s">, </span><span class="sh">'</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
    <span class="n">generator</span><span class="p">.</span><span class="nf">add_line</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">def __init__(self, </span><span class="si">{</span><span class="n">params</span><span class="si">}</span><span class="s">):</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">generator</span><span class="p">.</span><span class="nf">indent</span><span class="p">()</span>
    
    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
        <span class="n">generator</span><span class="p">.</span><span class="nf">add_line</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">self.</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s"> = </span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="n">generator</span><span class="p">.</span><span class="nf">dedent</span><span class="p">()</span>
    
    <span class="c1"># __str__ æ–¹æ³•
</span>    <span class="n">generator</span><span class="p">.</span><span class="nf">add_line</span><span class="p">(</span><span class="sh">"</span><span class="s">def __str__(self):</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">generator</span><span class="p">.</span><span class="nf">indent</span><span class="p">()</span>
    
    <span class="n">field_strs</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="sh">"'</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s">: }</span><span class="sh">'"</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'</span><span class="s">{field}</span><span class="sh">'</span><span class="p">,</span> <span class="sa">f</span><span class="sh">'</span><span class="s">self.</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="sh">'</span><span class="p">)</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">]</span>
    <span class="n">fields_format</span> <span class="o">=</span> <span class="sh">'</span><span class="s"> + </span><span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="s"> + </span><span class="sh">'</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">field_strs</span><span class="p">)</span>
    <span class="n">generator</span><span class="p">.</span><span class="nf">add_line</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">return f</span><span class="sh">'</span><span class="si">{</span><span class="n">class_name</span><span class="si">}</span><span class="s">(</span><span class="sh">'</span><span class="s"> + </span><span class="si">{</span><span class="n">fields_format</span><span class="si">}</span><span class="s"> + </span><span class="sh">'</span><span class="s">)</span><span class="sh">'"</span><span class="p">)</span>
    
    <span class="n">generator</span><span class="p">.</span><span class="nf">dedent</span><span class="p">()</span>
    
    <span class="c1"># __repr__ æ–¹æ³•
</span>    <span class="n">generator</span><span class="p">.</span><span class="nf">add_line</span><span class="p">(</span><span class="sh">"</span><span class="s">def __repr__(self):</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">generator</span><span class="p">.</span><span class="nf">indent</span><span class="p">()</span>
    <span class="n">generator</span><span class="p">.</span><span class="nf">add_line</span><span class="p">(</span><span class="sh">"</span><span class="s">return self.__str__()</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">generator</span><span class="p">.</span><span class="nf">get_code</span><span class="p">()</span>

<span class="c1"># ç”Ÿæˆå¹¶æ‰§è¡Œæ•°æ®ç±»
</span><span class="n">data_fields</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">age</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">city</span><span class="sh">'</span><span class="p">]</span>
<span class="n">data_class_code</span> <span class="o">=</span> <span class="nf">generate_data_class</span><span class="p">(</span><span class="sh">'</span><span class="s">Person</span><span class="sh">'</span><span class="p">,</span> <span class="n">data_fields</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="s">ç”Ÿæˆçš„æ•°æ®ç±»ä»£ç :</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">data_class_code</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="s">æ‰§è¡Œç”Ÿæˆçš„ç±»:</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">exec</span><span class="p">(</span><span class="n">data_class_code</span><span class="p">)</span>

<span class="c1"># æµ‹è¯•ç”Ÿæˆçš„ç±»
</span><span class="n">person1</span> <span class="o">=</span> <span class="nc">Person</span><span class="p">(</span><span class="sh">'</span><span class="s">Alice</span><span class="sh">'</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="sh">'</span><span class="s">Beijing</span><span class="sh">'</span><span class="p">)</span>
<span class="n">person2</span> <span class="o">=</span> <span class="nc">Person</span><span class="p">(</span><span class="sh">'</span><span class="s">Bob</span><span class="sh">'</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="sh">'</span><span class="s">Shanghai</span><span class="sh">'</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">person1: </span><span class="si">{</span><span class="n">person1</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">person2: </span><span class="si">{</span><span class="n">person2</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="é…ç½®é©±åŠ¨çš„ä»£ç æ‰§è¡Œ">é…ç½®é©±åŠ¨çš„ä»£ç æ‰§è¡Œ</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">json</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">List</span>

<span class="c1"># é…ç½®é©±åŠ¨çš„ä»£ç æ‰§è¡Œç³»ç»Ÿ
</span><span class="k">class</span> <span class="nc">ConfigDrivenExecutor</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">é…ç½®é©±åŠ¨çš„ä»£ç æ‰§è¡Œå™¨</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">safe_builtins</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">print</span><span class="sh">'</span><span class="p">:</span> <span class="k">print</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">len</span><span class="sh">'</span><span class="p">:</span> <span class="nb">len</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">range</span><span class="sh">'</span><span class="p">:</span> <span class="nb">range</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">enumerate</span><span class="sh">'</span><span class="p">:</span> <span class="nb">enumerate</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">zip</span><span class="sh">'</span><span class="p">:</span> <span class="nb">zip</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">map</span><span class="sh">'</span><span class="p">:</span> <span class="nb">map</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">filter</span><span class="sh">'</span><span class="p">:</span> <span class="nb">filter</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">sum</span><span class="sh">'</span><span class="p">:</span> <span class="nb">sum</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">max</span><span class="sh">'</span><span class="p">:</span> <span class="nb">max</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">min</span><span class="sh">'</span><span class="p">:</span> <span class="nb">min</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">abs</span><span class="sh">'</span><span class="p">:</span> <span class="nb">abs</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">round</span><span class="sh">'</span><span class="p">:</span> <span class="nb">round</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">int</span><span class="sh">'</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">float</span><span class="sh">'</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">str</span><span class="sh">'</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">bool</span><span class="sh">'</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">list</span><span class="sh">'</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">tuple</span><span class="sh">'</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">dict</span><span class="sh">'</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">set</span><span class="sh">'</span><span class="p">:</span> <span class="nb">set</span>
        <span class="p">}</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">execution_context</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">__builtins__</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">safe_builtins</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">data</span><span class="sh">'</span><span class="p">:</span> <span class="p">{},</span>
            <span class="sh">'</span><span class="s">results</span><span class="sh">'</span><span class="p">:</span> <span class="p">{},</span>
            <span class="sh">'</span><span class="s">config</span><span class="sh">'</span><span class="p">:</span> <span class="p">{}</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">load_config</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">config_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
        <span class="sh">"""</span><span class="s">åŠ è½½é…ç½®</span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="n">execution_context</span><span class="p">[</span><span class="sh">'</span><span class="s">config</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">config_data</span>
    
    <span class="k">def</span> <span class="nf">set_data</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
        <span class="sh">"""</span><span class="s">è®¾ç½®æ•°æ®</span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="n">execution_context</span><span class="p">[</span><span class="sh">'</span><span class="s">data</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
    
    <span class="k">def</span> <span class="nf">execute_script</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">script</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sh">"""</span><span class="s">æ‰§è¡Œè„šæœ¬</span><span class="sh">"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># åˆ›å»ºç‹¬ç«‹çš„å±€éƒ¨å‘½åç©ºé—´
</span>            <span class="n">local_context</span> <span class="o">=</span> <span class="p">{}</span>
            
            <span class="c1"># æ‰§è¡Œè„šæœ¬
</span>            <span class="nf">exec</span><span class="p">(</span><span class="n">script</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">execution_context</span><span class="p">,</span> <span class="n">local_context</span><span class="p">)</span>
            
            <span class="c1"># æ›´æ–°ç»“æœ
</span>            <span class="k">if</span> <span class="sh">'</span><span class="s">results</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">local_context</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="n">execution_context</span><span class="p">[</span><span class="sh">'</span><span class="s">results</span><span class="sh">'</span><span class="p">].</span><span class="nf">update</span><span class="p">(</span><span class="n">local_context</span><span class="p">[</span><span class="sh">'</span><span class="s">results</span><span class="sh">'</span><span class="p">])</span>
            
            <span class="k">return</span> <span class="n">local_context</span>
            
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nc">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">è„šæœ¬æ‰§è¡Œå¤±è´¥: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">execute_config_scripts</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sh">"""</span><span class="s">æ‰§è¡Œé…ç½®ä¸­çš„è„šæœ¬</span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">load_config</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="c1"># æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬
</span>        <span class="k">if</span> <span class="sh">'</span><span class="s">init_script</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬...</span><span class="sh">"</span><span class="p">)</span>
            <span class="n">init_result</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">execute_script</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="sh">'</span><span class="s">init_script</span><span class="sh">'</span><span class="p">])</span>
            <span class="n">results</span><span class="p">[</span><span class="sh">'</span><span class="s">init</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">init_result</span>
        
        <span class="c1"># æ‰§è¡Œæ•°æ®å¤„ç†è„šæœ¬
</span>        <span class="k">if</span> <span class="sh">'</span><span class="s">data_scripts</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="sh">'</span><span class="s">data_processing</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">script</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="sh">'</span><span class="s">data_scripts</span><span class="sh">'</span><span class="p">]):</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">æ‰§è¡Œæ•°æ®å¤„ç†è„šæœ¬ </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s">...</span><span class="sh">"</span><span class="p">)</span>
                <span class="n">script_result</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">execute_script</span><span class="p">(</span><span class="n">script</span><span class="p">)</span>
                <span class="n">results</span><span class="p">[</span><span class="sh">'</span><span class="s">data_processing</span><span class="sh">'</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span><span class="n">script_result</span><span class="p">)</span>
        
        <span class="c1"># æ‰§è¡Œæ¸…ç†è„šæœ¬
</span>        <span class="k">if</span> <span class="sh">'</span><span class="s">cleanup_script</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">æ‰§è¡Œæ¸…ç†è„šæœ¬...</span><span class="sh">"</span><span class="p">)</span>
            <span class="n">cleanup_result</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">execute_script</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="sh">'</span><span class="s">cleanup_script</span><span class="sh">'</span><span class="p">])</span>
            <span class="n">results</span><span class="p">[</span><span class="sh">'</span><span class="s">cleanup</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">cleanup_result</span>
        
        <span class="k">return</span> <span class="n">results</span>

<span class="c1"># æµ‹è¯•é…ç½®é©±åŠ¨æ‰§è¡Œ
</span><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">é…ç½®é©±åŠ¨æ‰§è¡Œç¤ºä¾‹:</span><span class="sh">"</span><span class="p">)</span>

<span class="n">executor</span> <span class="o">=</span> <span class="nc">ConfigDrivenExecutor</span><span class="p">()</span>

<span class="c1"># è®¾ç½®æµ‹è¯•æ•°æ®
</span><span class="n">test_data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">'</span><span class="s">numbers</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
    <span class="sh">'</span><span class="s">names</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="sh">'</span><span class="s">Alice</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Bob</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Charlie</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">David</span><span class="sh">'</span><span class="p">],</span>
    <span class="sh">'</span><span class="s">scores</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mi">85</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">78</span><span class="p">,</span> <span class="mi">96</span><span class="p">]</span>
<span class="p">}</span>

<span class="n">executor</span><span class="p">.</span><span class="nf">set_data</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span>

<span class="c1"># é…ç½®è„šæœ¬
</span><span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">'</span><span class="s">init_script</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'''</span><span class="s">
# åˆå§‹åŒ–å˜é‡
total_count = 0
processed_items = []
statistics = {}

print(</span><span class="sh">"</span><span class="s">åˆå§‹åŒ–å®Œæˆ</span><span class="sh">"</span><span class="s">)
</span><span class="sh">'''</span><span class="p">,</span>
    
    <span class="sh">'</span><span class="s">data_scripts</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span>
        <span class="sh">'''</span><span class="s">
# å¤„ç†æ•°å­—æ•°æ®
numbers = data[</span><span class="sh">'</span><span class="s">numbers</span><span class="sh">'</span><span class="s">]
even_numbers = [n for n in numbers if n % 2 == 0]
odd_numbers = [n for n in numbers if n % 2 == 1]

statistics[</span><span class="sh">'</span><span class="s">even_count</span><span class="sh">'</span><span class="s">] = len(even_numbers)
statistics[</span><span class="sh">'</span><span class="s">odd_count</span><span class="sh">'</span><span class="s">] = len(odd_numbers)
statistics[</span><span class="sh">'</span><span class="s">total_sum</span><span class="sh">'</span><span class="s">] = sum(numbers)
statistics[</span><span class="sh">'</span><span class="s">average</span><span class="sh">'</span><span class="s">] = sum(numbers) / len(numbers)

print(f</span><span class="sh">"</span><span class="s">å¤„ç†äº† {len(numbers)} ä¸ªæ•°å­—</span><span class="sh">"</span><span class="s">)
print(f</span><span class="sh">"</span><span class="s">å¶æ•°: {even_numbers}</span><span class="sh">"</span><span class="s">)
print(f</span><span class="sh">"</span><span class="s">å¥‡æ•°: {odd_numbers}</span><span class="sh">"</span><span class="s">)
</span><span class="sh">'''</span><span class="p">,</span>
        
        <span class="sh">'''</span><span class="s">
# å¤„ç†åå­—å’Œåˆ†æ•°æ•°æ®
names = data[</span><span class="sh">'</span><span class="s">names</span><span class="sh">'</span><span class="s">]
scores = data[</span><span class="sh">'</span><span class="s">scores</span><span class="sh">'</span><span class="s">]

# åˆ›å»ºå­¦ç”Ÿè®°å½•
students = []
for name, score in zip(names, scores):
    grade = </span><span class="sh">'</span><span class="s">A</span><span class="sh">'</span><span class="s"> if score &gt;= 90 else </span><span class="sh">'</span><span class="s">B</span><span class="sh">'</span><span class="s"> if score &gt;= 80 else </span><span class="sh">'</span><span class="s">C</span><span class="sh">'</span><span class="s">
    students.append({
        </span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="s">: name,
        </span><span class="sh">'</span><span class="s">score</span><span class="sh">'</span><span class="s">: score,
        </span><span class="sh">'</span><span class="s">grade</span><span class="sh">'</span><span class="s">: grade
    })

# ç»Ÿè®¡æˆç»©
grade_counts = {</span><span class="sh">'</span><span class="s">A</span><span class="sh">'</span><span class="s">: 0, </span><span class="sh">'</span><span class="s">B</span><span class="sh">'</span><span class="s">: 0, </span><span class="sh">'</span><span class="s">C</span><span class="sh">'</span><span class="s">: 0}
for student in students:
    grade_counts[student[</span><span class="sh">'</span><span class="s">grade</span><span class="sh">'</span><span class="s">]] += 1

statistics[</span><span class="sh">'</span><span class="s">students</span><span class="sh">'</span><span class="s">] = students
statistics[</span><span class="sh">'</span><span class="s">grade_distribution</span><span class="sh">'</span><span class="s">] = grade_counts
statistics[</span><span class="sh">'</span><span class="s">highest_score</span><span class="sh">'</span><span class="s">] = max(scores)
statistics[</span><span class="sh">'</span><span class="s">lowest_score</span><span class="sh">'</span><span class="s">] = min(scores)

print(f</span><span class="sh">"</span><span class="s">å¤„ç†äº† {len(students)} ä¸ªå­¦ç”Ÿè®°å½•</span><span class="sh">"</span><span class="s">)
for student in students:
    print(f</span><span class="sh">"</span><span class="s">  {student[</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="s">]}: {student[</span><span class="sh">'</span><span class="s">score</span><span class="sh">'</span><span class="s">]} ({student[</span><span class="sh">'</span><span class="s">grade</span><span class="sh">'</span><span class="s">]})</span><span class="sh">"</span><span class="s">)
</span><span class="sh">'''</span>
    <span class="p">],</span>
    
    <span class="sh">'</span><span class="s">cleanup_script</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'''</span><span class="s">
# ç”Ÿæˆæœ€ç»ˆæŠ¥å‘Š
report = {
    </span><span class="sh">'</span><span class="s">summary</span><span class="sh">'</span><span class="s">: {
        </span><span class="sh">'</span><span class="s">total_numbers</span><span class="sh">'</span><span class="s">: len(data[</span><span class="sh">'</span><span class="s">numbers</span><span class="sh">'</span><span class="s">]),
        </span><span class="sh">'</span><span class="s">total_students</span><span class="sh">'</span><span class="s">: len(data[</span><span class="sh">'</span><span class="s">names</span><span class="sh">'</span><span class="s">]),
        </span><span class="sh">'</span><span class="s">processing_complete</span><span class="sh">'</span><span class="s">: True
    },
    </span><span class="sh">'</span><span class="s">statistics</span><span class="sh">'</span><span class="s">: statistics
}

results[</span><span class="sh">'</span><span class="s">final_report</span><span class="sh">'</span><span class="s">] = report

print(</span><span class="sh">"</span><span class="se">\n</span><span class="s">=== æœ€ç»ˆæŠ¥å‘Š ===</span><span class="sh">"</span><span class="s">)
print(f</span><span class="sh">"</span><span class="s">å¤„ç†æ•°å­—æ€»æ•°: {report[</span><span class="sh">'</span><span class="s">summary</span><span class="sh">'</span><span class="s">][</span><span class="sh">'</span><span class="s">total_numbers</span><span class="sh">'</span><span class="s">]}</span><span class="sh">"</span><span class="s">)
print(f</span><span class="sh">"</span><span class="s">å­¦ç”Ÿæ€»æ•°: {report[</span><span class="sh">'</span><span class="s">summary</span><span class="sh">'</span><span class="s">][</span><span class="sh">'</span><span class="s">total_students</span><span class="sh">'</span><span class="s">]}</span><span class="sh">"</span><span class="s">)
print(f</span><span class="sh">"</span><span class="s">æ•°å­—æ€»å’Œ: {statistics[</span><span class="sh">'</span><span class="s">total_sum</span><span class="sh">'</span><span class="s">]}</span><span class="sh">"</span><span class="s">)
print(f</span><span class="sh">"</span><span class="s">å¹³å‡å€¼: {statistics[</span><span class="sh">'</span><span class="s">average</span><span class="sh">'</span><span class="s">]:.2f}</span><span class="sh">"</span><span class="s">)
print(f</span><span class="sh">"</span><span class="s">æœ€é«˜åˆ†: {statistics[</span><span class="sh">'</span><span class="s">highest_score</span><span class="sh">'</span><span class="s">]}</span><span class="sh">"</span><span class="s">)
print(f</span><span class="sh">"</span><span class="s">æœ€ä½åˆ†: {statistics[</span><span class="sh">'</span><span class="s">lowest_score</span><span class="sh">'</span><span class="s">]}</span><span class="sh">"</span><span class="s">)
print(f</span><span class="sh">"</span><span class="s">æˆç»©åˆ†å¸ƒ: {statistics[</span><span class="sh">'</span><span class="s">grade_distribution</span><span class="sh">'</span><span class="s">]}</span><span class="sh">"</span><span class="s">)
print(</span><span class="sh">"</span><span class="s">å¤„ç†å®Œæˆ!</span><span class="sh">"</span><span class="s">)
</span><span class="sh">'''</span>
<span class="p">}</span>

<span class="c1"># æ‰§è¡Œé…ç½®è„šæœ¬
</span><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">å¼€å§‹æ‰§è¡Œé…ç½®è„šæœ¬:</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">=</span><span class="sh">"</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">execution_results</span> <span class="o">=</span> <span class="n">executor</span><span class="p">.</span><span class="nf">execute_config_scripts</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">=== æ‰§è¡Œç»“æœ ===</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">if</span> <span class="sh">'</span><span class="s">final_report</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">executor</span><span class="p">.</span><span class="n">execution_context</span><span class="p">[</span><span class="sh">'</span><span class="s">results</span><span class="sh">'</span><span class="p">]:</span>
        <span class="n">final_report</span> <span class="o">=</span> <span class="n">executor</span><span class="p">.</span><span class="n">execution_context</span><span class="p">[</span><span class="sh">'</span><span class="s">results</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">final_report</span><span class="sh">'</span><span class="p">]</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">æœ€ç»ˆæŠ¥å‘Šå·²ç”Ÿæˆ</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">ç»Ÿè®¡ä¿¡æ¯: </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">final_report</span><span class="p">[</span><span class="sh">'</span><span class="s">statistics</span><span class="sh">'</span><span class="p">])</span><span class="si">}</span><span class="s"> é¡¹</span><span class="sh">"</span><span class="p">)</span>
    
<span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">æ‰§è¡Œå¤±è´¥: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="-é«˜çº§åº”ç”¨">ğŸš€ é«˜çº§åº”ç”¨</h2>

<h3 id="æ’ä»¶ç³»ç»Ÿ">æ’ä»¶ç³»ç»Ÿ</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">os</span>
<span class="kn">import</span> <span class="n">importlib.util</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Callable</span>
<span class="kn">from</span> <span class="n">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>

<span class="c1"># æ’ä»¶ç³»ç»Ÿå®ç°
</span><span class="k">class</span> <span class="nc">Plugin</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">æ’ä»¶åŸºç±»</span><span class="sh">"""</span>
    
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">get_name</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">è·å–æ’ä»¶åç§°</span><span class="sh">"""</span>
        <span class="k">pass</span>
    
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">get_version</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">è·å–æ’ä»¶ç‰ˆæœ¬</span><span class="sh">"""</span>
        <span class="k">pass</span>
    
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">æ‰§è¡Œæ’ä»¶</span><span class="sh">"""</span>
        <span class="k">pass</span>

<span class="k">class</span> <span class="nc">PluginManager</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">æ’ä»¶ç®¡ç†å™¨</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">plugins</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Plugin</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">self</span><span class="p">.</span><span class="n">plugin_code_cache</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="c1"># å®‰å…¨çš„æ‰§è¡Œç¯å¢ƒ
</span>        <span class="n">self</span><span class="p">.</span><span class="n">safe_globals</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">__builtins__</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span>
                <span class="sh">'</span><span class="s">print</span><span class="sh">'</span><span class="p">:</span> <span class="k">print</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">len</span><span class="sh">'</span><span class="p">:</span> <span class="nb">len</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">range</span><span class="sh">'</span><span class="p">:</span> <span class="nb">range</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">enumerate</span><span class="sh">'</span><span class="p">:</span> <span class="nb">enumerate</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">zip</span><span class="sh">'</span><span class="p">:</span> <span class="nb">zip</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">sum</span><span class="sh">'</span><span class="p">:</span> <span class="nb">sum</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">max</span><span class="sh">'</span><span class="p">:</span> <span class="nb">max</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">min</span><span class="sh">'</span><span class="p">:</span> <span class="nb">min</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">abs</span><span class="sh">'</span><span class="p">:</span> <span class="nb">abs</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">round</span><span class="sh">'</span><span class="p">:</span> <span class="nb">round</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">int</span><span class="sh">'</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">float</span><span class="sh">'</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">str</span><span class="sh">'</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">bool</span><span class="sh">'</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">list</span><span class="sh">'</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">tuple</span><span class="sh">'</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">dict</span><span class="sh">'</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">set</span><span class="sh">'</span><span class="p">:</span> <span class="nb">set</span>
            <span class="p">},</span>
            <span class="sh">'</span><span class="s">Plugin</span><span class="sh">'</span><span class="p">:</span> <span class="n">Plugin</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">load_plugin_from_code</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">plugin_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">plugin_code</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">ä»ä»£ç åŠ è½½æ’ä»¶</span><span class="sh">"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># åˆ›å»ºæ’ä»¶å‘½åç©ºé—´
</span>            <span class="n">plugin_namespace</span> <span class="o">=</span> <span class="p">{}</span>
            
            <span class="c1"># æ‰§è¡Œæ’ä»¶ä»£ç 
</span>            <span class="nf">exec</span><span class="p">(</span><span class="n">plugin_code</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">safe_globals</span><span class="p">,</span> <span class="n">plugin_namespace</span><span class="p">)</span>
            
            <span class="c1"># æŸ¥æ‰¾æ’ä»¶ç±»
</span>            <span class="n">plugin_class</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">plugin_namespace</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
                <span class="nf">if </span><span class="p">(</span><span class="nf">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span> <span class="ow">and</span> 
                    <span class="nf">issubclass</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Plugin</span><span class="p">)</span> <span class="ow">and</span> 
                    <span class="n">obj</span> <span class="o">!=</span> <span class="n">Plugin</span><span class="p">):</span>
                    <span class="n">plugin_class</span> <span class="o">=</span> <span class="n">obj</span>
                    <span class="k">break</span>
            
            <span class="k">if</span> <span class="n">plugin_class</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="nc">ValueError</span><span class="p">(</span><span class="sh">"</span><span class="s">æœªæ‰¾åˆ°æœ‰æ•ˆçš„æ’ä»¶ç±»</span><span class="sh">"</span><span class="p">)</span>
            
            <span class="c1"># åˆ›å»ºæ’ä»¶å®ä¾‹
</span>            <span class="n">plugin_instance</span> <span class="o">=</span> <span class="nf">plugin_class</span><span class="p">()</span>
            
            <span class="c1"># æ³¨å†Œæ’ä»¶
</span>            <span class="n">self</span><span class="p">.</span><span class="n">plugins</span><span class="p">[</span><span class="n">plugin_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">plugin_instance</span>
            <span class="n">self</span><span class="p">.</span><span class="n">plugin_code_cache</span><span class="p">[</span><span class="n">plugin_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">plugin_code</span>
            
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">æ’ä»¶ </span><span class="sh">'</span><span class="si">{</span><span class="n">plugin_name</span><span class="si">}</span><span class="sh">'</span><span class="s"> åŠ è½½æˆåŠŸ</span><span class="sh">"</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  åç§°: </span><span class="si">{</span><span class="n">plugin_instance</span><span class="p">.</span><span class="nf">get_name</span><span class="p">()</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  ç‰ˆæœ¬: </span><span class="si">{</span><span class="n">plugin_instance</span><span class="p">.</span><span class="nf">get_version</span><span class="p">()</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            
            <span class="k">return</span> <span class="bp">True</span>
            
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">åŠ è½½æ’ä»¶ </span><span class="sh">'</span><span class="si">{</span><span class="n">plugin_name</span><span class="si">}</span><span class="sh">'</span><span class="s"> å¤±è´¥: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
    
    <span class="k">def</span> <span class="nf">execute_plugin</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">plugin_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">æ‰§è¡Œæ’ä»¶</span><span class="sh">"""</span>
        <span class="k">if</span> <span class="n">plugin_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">plugins</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nc">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">æ’ä»¶ </span><span class="sh">'</span><span class="si">{</span><span class="n">plugin_name</span><span class="si">}</span><span class="sh">'</span><span class="s"> æœªæ‰¾åˆ°</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="n">plugin</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">plugins</span><span class="p">[</span><span class="n">plugin_name</span><span class="p">]</span>
        <span class="n">context</span> <span class="o">=</span> <span class="n">context</span> <span class="ow">or</span> <span class="p">{}</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">plugin</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nc">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">æ‰§è¡Œæ’ä»¶ </span><span class="sh">'</span><span class="si">{</span><span class="n">plugin_name</span><span class="si">}</span><span class="sh">'</span><span class="s"> å¤±è´¥: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">list_plugins</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
        <span class="sh">"""</span><span class="s">åˆ—å‡ºæ‰€æœ‰æ’ä»¶</span><span class="sh">"""</span>
        <span class="n">plugin_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">plugin</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">plugins</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="n">plugin_list</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">plugin_name</span><span class="sh">'</span><span class="p">:</span> <span class="n">plugin</span><span class="p">.</span><span class="nf">get_name</span><span class="p">(),</span>
                <span class="sh">'</span><span class="s">version</span><span class="sh">'</span><span class="p">:</span> <span class="n">plugin</span><span class="p">.</span><span class="nf">get_version</span><span class="p">()</span>
            <span class="p">})</span>
        <span class="k">return</span> <span class="n">plugin_list</span>
    
    <span class="k">def</span> <span class="nf">unload_plugin</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">plugin_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">å¸è½½æ’ä»¶</span><span class="sh">"""</span>
        <span class="k">if</span> <span class="n">plugin_name</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">plugins</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">self</span><span class="p">.</span><span class="n">plugins</span><span class="p">[</span><span class="n">plugin_name</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">plugin_name</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">plugin_code_cache</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">self</span><span class="p">.</span><span class="n">plugin_code_cache</span><span class="p">[</span><span class="n">plugin_name</span><span class="p">]</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">æ’ä»¶ </span><span class="sh">'</span><span class="si">{</span><span class="n">plugin_name</span><span class="si">}</span><span class="sh">'</span><span class="s"> å·²å¸è½½</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">False</span>

<span class="c1"># æµ‹è¯•æ’ä»¶ç³»ç»Ÿ
</span><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">æ’ä»¶ç³»ç»Ÿç¤ºä¾‹:</span><span class="sh">"</span><span class="p">)</span>

<span class="n">plugin_manager</span> <span class="o">=</span> <span class="nc">PluginManager</span><span class="p">()</span>

<span class="c1"># æ•°å­¦è®¡ç®—æ’ä»¶
</span><span class="n">math_plugin_code</span> <span class="o">=</span> <span class="sh">'''</span><span class="s">
class MathPlugin(Plugin):
    </span><span class="sh">"""</span><span class="s">æ•°å­¦è®¡ç®—æ’ä»¶</span><span class="sh">"""</span><span class="s">
    
    def get_name(self) -&gt; str:
        return </span><span class="sh">"</span><span class="s">æ•°å­¦è®¡ç®—å™¨</span><span class="sh">"</span><span class="s">
    
    def get_version(self) -&gt; str:
        return </span><span class="sh">"</span><span class="s">1.0.0</span><span class="sh">"</span><span class="s">
    
    def execute(self, context: dict) -&gt; dict:
        numbers = context.get(</span><span class="sh">'</span><span class="s">numbers</span><span class="sh">'</span><span class="s">, [])
        
        if not numbers:
            return {</span><span class="sh">'</span><span class="s">error</span><span class="sh">'</span><span class="s">: </span><span class="sh">'</span><span class="s">æ²¡æœ‰æä¾›æ•°å­—</span><span class="sh">'</span><span class="s">}
        
        results = {
            </span><span class="sh">'</span><span class="s">count</span><span class="sh">'</span><span class="s">: len(numbers),
            </span><span class="sh">'</span><span class="s">sum</span><span class="sh">'</span><span class="s">: sum(numbers),
            </span><span class="sh">'</span><span class="s">average</span><span class="sh">'</span><span class="s">: sum(numbers) / len(numbers),
            </span><span class="sh">'</span><span class="s">min</span><span class="sh">'</span><span class="s">: min(numbers),
            </span><span class="sh">'</span><span class="s">max</span><span class="sh">'</span><span class="s">: max(numbers),
            </span><span class="sh">'</span><span class="s">even_count</span><span class="sh">'</span><span class="s">: len([n for n in numbers if n % 2 == 0]),
            </span><span class="sh">'</span><span class="s">odd_count</span><span class="sh">'</span><span class="s">: len([n for n in numbers if n % 2 == 1])
        }
        
        return results
</span><span class="sh">'''</span>

<span class="c1"># æ–‡æœ¬å¤„ç†æ’ä»¶
</span><span class="n">text_plugin_code</span> <span class="o">=</span> <span class="sh">'''</span><span class="s">
class TextPlugin(Plugin):
    </span><span class="sh">"""</span><span class="s">æ–‡æœ¬å¤„ç†æ’ä»¶</span><span class="sh">"""</span><span class="s">
    
    def get_name(self) -&gt; str:
        return </span><span class="sh">"</span><span class="s">æ–‡æœ¬å¤„ç†å™¨</span><span class="sh">"</span><span class="s">
    
    def get_version(self) -&gt; str:
        return </span><span class="sh">"</span><span class="s">1.1.0</span><span class="sh">"</span><span class="s">
    
    def execute(self, context: dict) -&gt; dict:
        text = context.get(</span><span class="sh">'</span><span class="s">text</span><span class="sh">'</span><span class="s">, </span><span class="sh">''</span><span class="s">)
        
        if not text:
            return {</span><span class="sh">'</span><span class="s">error</span><span class="sh">'</span><span class="s">: </span><span class="sh">'</span><span class="s">æ²¡æœ‰æä¾›æ–‡æœ¬</span><span class="sh">'</span><span class="s">}
        
        words = text.split()
        
        results = {
            </span><span class="sh">'</span><span class="s">original_text</span><span class="sh">'</span><span class="s">: text,
            </span><span class="sh">'</span><span class="s">character_count</span><span class="sh">'</span><span class="s">: len(text),
            </span><span class="sh">'</span><span class="s">word_count</span><span class="sh">'</span><span class="s">: len(words),
            </span><span class="sh">'</span><span class="s">line_count</span><span class="sh">'</span><span class="s">: text.count(</span><span class="sh">'</span><span class="se">\\</span><span class="s">n</span><span class="sh">'</span><span class="s">) + 1,
            </span><span class="sh">'</span><span class="s">uppercase</span><span class="sh">'</span><span class="s">: text.upper(),
            </span><span class="sh">'</span><span class="s">lowercase</span><span class="sh">'</span><span class="s">: text.lower(),
            </span><span class="sh">'</span><span class="s">title_case</span><span class="sh">'</span><span class="s">: text.title(),
            </span><span class="sh">'</span><span class="s">word_frequency</span><span class="sh">'</span><span class="s">: {}
        }
        
        # è®¡ç®—è¯é¢‘
        for word in words:
            clean_word = word.lower().strip(</span><span class="sh">'</span><span class="s">.,!?;:</span><span class="sh">'</span><span class="s">)
            if clean_word:
                results[</span><span class="sh">'</span><span class="s">word_frequency</span><span class="sh">'</span><span class="s">][clean_word] = results[</span><span class="sh">'</span><span class="s">word_frequency</span><span class="sh">'</span><span class="s">].get(clean_word, 0) + 1
        
        return results
</span><span class="sh">'''</span>

<span class="c1"># æ•°æ®åˆ†ææ’ä»¶
</span><span class="n">data_plugin_code</span> <span class="o">=</span> <span class="sh">'''</span><span class="s">
class DataAnalysisPlugin(Plugin):
    </span><span class="sh">"""</span><span class="s">æ•°æ®åˆ†ææ’ä»¶</span><span class="sh">"""</span><span class="s">
    
    def get_name(self) -&gt; str:
        return </span><span class="sh">"</span><span class="s">æ•°æ®åˆ†æå™¨</span><span class="sh">"</span><span class="s">
    
    def get_version(self) -&gt; str:
        return </span><span class="sh">"</span><span class="s">2.0.0</span><span class="sh">"</span><span class="s">
    
    def execute(self, context: dict) -&gt; dict:
        data = context.get(</span><span class="sh">'</span><span class="s">data</span><span class="sh">'</span><span class="s">, [])
        
        if not data:
            return {</span><span class="sh">'</span><span class="s">error</span><span class="sh">'</span><span class="s">: </span><span class="sh">'</span><span class="s">æ²¡æœ‰æä¾›æ•°æ®</span><span class="sh">'</span><span class="s">}
        
        # åˆ†æä¸åŒç±»å‹çš„æ•°æ®
        analysis = {
            </span><span class="sh">'</span><span class="s">total_items</span><span class="sh">'</span><span class="s">: len(data),
            </span><span class="sh">'</span><span class="s">data_types</span><span class="sh">'</span><span class="s">: {},
            </span><span class="sh">'</span><span class="s">numeric_analysis</span><span class="sh">'</span><span class="s">: {},
            </span><span class="sh">'</span><span class="s">string_analysis</span><span class="sh">'</span><span class="s">: {},
            </span><span class="sh">'</span><span class="s">list_analysis</span><span class="sh">'</span><span class="s">: {}
        }
        
        # ç»Ÿè®¡æ•°æ®ç±»å‹
        for item in data:
            item_type = type(item).__name__
            analysis[</span><span class="sh">'</span><span class="s">data_types</span><span class="sh">'</span><span class="s">][item_type] = analysis[</span><span class="sh">'</span><span class="s">data_types</span><span class="sh">'</span><span class="s">].get(item_type, 0) + 1
        
        # æ•°å€¼åˆ†æ
        numeric_data = [item for item in data if isinstance(item, (int, float))]
        if numeric_data:
            analysis[</span><span class="sh">'</span><span class="s">numeric_analysis</span><span class="sh">'</span><span class="s">] = {
                </span><span class="sh">'</span><span class="s">count</span><span class="sh">'</span><span class="s">: len(numeric_data),
                </span><span class="sh">'</span><span class="s">sum</span><span class="sh">'</span><span class="s">: sum(numeric_data),
                </span><span class="sh">'</span><span class="s">average</span><span class="sh">'</span><span class="s">: sum(numeric_data) / len(numeric_data),
                </span><span class="sh">'</span><span class="s">min</span><span class="sh">'</span><span class="s">: min(numeric_data),
                </span><span class="sh">'</span><span class="s">max</span><span class="sh">'</span><span class="s">: max(numeric_data)
            }
        
        # å­—ç¬¦ä¸²åˆ†æ
        string_data = [item for item in data if isinstance(item, str)]
        if string_data:
            analysis[</span><span class="sh">'</span><span class="s">string_analysis</span><span class="sh">'</span><span class="s">] = {
                </span><span class="sh">'</span><span class="s">count</span><span class="sh">'</span><span class="s">: len(string_data),
                </span><span class="sh">'</span><span class="s">total_length</span><span class="sh">'</span><span class="s">: sum(len(s) for s in string_data),
                </span><span class="sh">'</span><span class="s">average_length</span><span class="sh">'</span><span class="s">: sum(len(s) for s in string_data) / len(string_data),
                </span><span class="sh">'</span><span class="s">longest</span><span class="sh">'</span><span class="s">: max(string_data, key=len),
                </span><span class="sh">'</span><span class="s">shortest</span><span class="sh">'</span><span class="s">: min(string_data, key=len)
            }
        
        # åˆ—è¡¨åˆ†æ
        list_data = [item for item in data if isinstance(item, list)]
        if list_data:
            analysis[</span><span class="sh">'</span><span class="s">list_analysis</span><span class="sh">'</span><span class="s">] = {
                </span><span class="sh">'</span><span class="s">count</span><span class="sh">'</span><span class="s">: len(list_data),
                </span><span class="sh">'</span><span class="s">total_elements</span><span class="sh">'</span><span class="s">: sum(len(lst) for lst in list_data),
                </span><span class="sh">'</span><span class="s">average_length</span><span class="sh">'</span><span class="s">: sum(len(lst) for lst in list_data) / len(list_data)
            }
        
        return analysis
</span><span class="sh">'''</span>

<span class="c1"># åŠ è½½æ’ä»¶
</span><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">åŠ è½½æ’ä»¶:</span><span class="sh">"</span><span class="p">)</span>
<span class="n">plugin_manager</span><span class="p">.</span><span class="nf">load_plugin_from_code</span><span class="p">(</span><span class="sh">'</span><span class="s">math</span><span class="sh">'</span><span class="p">,</span> <span class="n">math_plugin_code</span><span class="p">)</span>
<span class="n">plugin_manager</span><span class="p">.</span><span class="nf">load_plugin_from_code</span><span class="p">(</span><span class="sh">'</span><span class="s">text</span><span class="sh">'</span><span class="p">,</span> <span class="n">text_plugin_code</span><span class="p">)</span>
<span class="n">plugin_manager</span><span class="p">.</span><span class="nf">load_plugin_from_code</span><span class="p">(</span><span class="sh">'</span><span class="s">data</span><span class="sh">'</span><span class="p">,</span> <span class="n">data_plugin_code</span><span class="p">)</span>

<span class="c1"># åˆ—å‡ºæ’ä»¶
</span><span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="s">å·²åŠ è½½çš„æ’ä»¶:</span><span class="sh">"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">plugin_info</span> <span class="ow">in</span> <span class="n">plugin_manager</span><span class="p">.</span><span class="nf">list_plugins</span><span class="p">():</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  </span><span class="si">{</span><span class="n">plugin_info</span><span class="p">[</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">plugin_info</span><span class="p">[</span><span class="sh">'</span><span class="s">plugin_name</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="s"> v</span><span class="si">{</span><span class="n">plugin_info</span><span class="p">[</span><span class="sh">'</span><span class="s">version</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># æµ‹è¯•æ•°å­¦æ’ä»¶
</span><span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="s">æµ‹è¯•æ•°å­¦æ’ä»¶:</span><span class="sh">"</span><span class="p">)</span>
<span class="n">math_context</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">numbers</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">]}</span>
<span class="n">math_result</span> <span class="o">=</span> <span class="n">plugin_manager</span><span class="p">.</span><span class="nf">execute_plugin</span><span class="p">(</span><span class="sh">'</span><span class="s">math</span><span class="sh">'</span><span class="p">,</span> <span class="n">math_context</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">æ•°å­¦è®¡ç®—ç»“æœ: </span><span class="si">{</span><span class="n">math_result</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># æµ‹è¯•æ–‡æœ¬æ’ä»¶
</span><span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="s">æµ‹è¯•æ–‡æœ¬æ’ä»¶:</span><span class="sh">"</span><span class="p">)</span>
<span class="n">text_context</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">text</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Hello World! This is a test text. Hello again!</span><span class="sh">'</span><span class="p">}</span>
<span class="n">text_result</span> <span class="o">=</span> <span class="n">plugin_manager</span><span class="p">.</span><span class="nf">execute_plugin</span><span class="p">(</span><span class="sh">'</span><span class="s">text</span><span class="sh">'</span><span class="p">,</span> <span class="n">text_context</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">æ–‡æœ¬å¤„ç†ç»“æœ:</span><span class="sh">"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">text_result</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="sh">'</span><span class="s">word_frequency</span><span class="sh">'</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  è¯é¢‘ç»Ÿè®¡: </span><span class="si">{</span><span class="n">text_result</span><span class="p">[</span><span class="sh">'</span><span class="s">word_frequency</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># æµ‹è¯•æ•°æ®åˆ†ææ’ä»¶
</span><span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="s">æµ‹è¯•æ•°æ®åˆ†ææ’ä»¶:</span><span class="sh">"</span><span class="p">)</span>
<span class="n">data_context</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">'</span><span class="s">data</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="sh">'</span><span class="s">hello</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">world</span><span class="sh">'</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="mf">4.5</span><span class="p">,</span> <span class="sh">'</span><span class="s">test</span><span class="sh">'</span><span class="p">,</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]]</span>
<span class="p">}</span>
<span class="n">data_result</span> <span class="o">=</span> <span class="n">plugin_manager</span><span class="p">.</span><span class="nf">execute_plugin</span><span class="p">(</span><span class="sh">'</span><span class="s">data</span><span class="sh">'</span><span class="p">,</span> <span class="n">data_context</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">æ•°æ®åˆ†æç»“æœ:</span><span class="sh">"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data_result</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="æ¨¡æ¿å¼•æ“">æ¨¡æ¿å¼•æ“</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">re</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>

<span class="c1"># ç®€å•çš„æ¨¡æ¿å¼•æ“
</span><span class="k">class</span> <span class="nc">TemplateEngine</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">ç®€å•çš„æ¨¡æ¿å¼•æ“</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="c1"># æ¨¡æ¿è¯­æ³•æ¨¡å¼
</span>        
        <span class="n">self</span><span class="p">.</span><span class="n">variable_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">compile</span><span class="p">(</span><span class="sa">r</span><span class="sh">'</span><span class="s">\{\{\s*([^}]+)\s*\}\}</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">code_block_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">compile</span><span class="p">(</span><span class="sa">r</span><span class="sh">'</span><span class="s">\{%\s*([^%]+)\s*%\}</span><span class="sh">'</span><span class="p">,</span> <span class="n">re</span><span class="p">.</span><span class="n">DOTALL</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">comment_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">compile</span><span class="p">(</span><span class="sa">r</span><span class="sh">'</span><span class="s">\{#\s*([^#]*)\s*#\}</span><span class="sh">'</span><span class="p">)</span>
        
        
        <span class="c1"># å®‰å…¨çš„æ‰§è¡Œç¯å¢ƒ
</span>        <span class="n">self</span><span class="p">.</span><span class="n">safe_builtins</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">len</span><span class="sh">'</span><span class="p">:</span> <span class="nb">len</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">range</span><span class="sh">'</span><span class="p">:</span> <span class="nb">range</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">enumerate</span><span class="sh">'</span><span class="p">:</span> <span class="nb">enumerate</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">zip</span><span class="sh">'</span><span class="p">:</span> <span class="nb">zip</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">sum</span><span class="sh">'</span><span class="p">:</span> <span class="nb">sum</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">max</span><span class="sh">'</span><span class="p">:</span> <span class="nb">max</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">min</span><span class="sh">'</span><span class="p">:</span> <span class="nb">min</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">abs</span><span class="sh">'</span><span class="p">:</span> <span class="nb">abs</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">round</span><span class="sh">'</span><span class="p">:</span> <span class="nb">round</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">int</span><span class="sh">'</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">float</span><span class="sh">'</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">str</span><span class="sh">'</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">bool</span><span class="sh">'</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">list</span><span class="sh">'</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">tuple</span><span class="sh">'</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">dict</span><span class="sh">'</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">set</span><span class="sh">'</span><span class="p">:</span> <span class="nb">set</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">sorted</span><span class="sh">'</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">reversed</span><span class="sh">'</span><span class="p">:</span> <span class="nb">reversed</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">render_template</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">template</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">æ¸²æŸ“æ¨¡æ¿</span><span class="sh">"""</span>
        <span class="c1"># ç§»é™¤æ³¨é‡Š
</span>        <span class="n">template</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">comment_pattern</span><span class="p">.</span><span class="nf">sub</span><span class="p">(</span><span class="sh">''</span><span class="p">,</span> <span class="n">template</span><span class="p">)</span>
        
        <span class="c1"># å¤„ç†ä»£ç å—
</span>        <span class="n">template</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_process_code_blocks</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
        
        <span class="c1"># å¤„ç†å˜é‡
</span>        <span class="n">template</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_process_variables</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">template</span>
    
    <span class="k">def</span> <span class="nf">_process_variables</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">template</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">å¤„ç†å˜é‡æ›¿æ¢</span><span class="sh">"""</span>
        <span class="k">def</span> <span class="nf">replace_variable</span><span class="p">(</span><span class="n">match</span><span class="p">):</span>
            <span class="n">var_expr</span> <span class="o">=</span> <span class="k">match</span><span class="p">.</span><span class="nf">group</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nf">strip</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># åˆ›å»ºå®‰å…¨çš„æ‰§è¡Œç¯å¢ƒ
</span>                <span class="n">safe_context</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="sh">'</span><span class="s">__builtins__</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">safe_builtins</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">context</span>
                <span class="p">}</span>
                
                <span class="c1"># æ±‚å€¼å˜é‡è¡¨è¾¾å¼
</span>                <span class="n">result</span> <span class="o">=</span> <span class="nf">eval</span><span class="p">(</span><span class="n">var_expr</span><span class="p">,</span> <span class="n">safe_context</span><span class="p">,</span> <span class="p">{})</span>
                <span class="k">return</span> <span class="nf">str</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">return</span> <span class="sa">f</span><span class="sh">"</span><span class="s">{{{{ ERROR: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s"> }}}}</span><span class="sh">"</span>
        
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">variable_pattern</span><span class="p">.</span><span class="nf">sub</span><span class="p">(</span><span class="n">replace_variable</span><span class="p">,</span> <span class="n">template</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_process_code_blocks</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">template</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">å¤„ç†ä»£ç å—</span><span class="sh">"""</span>
        <span class="k">def</span> <span class="nf">replace_code_block</span><span class="p">(</span><span class="n">match</span><span class="p">):</span>
            <span class="n">code</span> <span class="o">=</span> <span class="k">match</span><span class="p">.</span><span class="nf">group</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nf">strip</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># åˆ›å»ºè¾“å‡ºç¼“å†²åŒº
</span>                <span class="n">output_buffer</span> <span class="o">=</span> <span class="p">[]</span>
                
                <span class="c1"># åˆ›å»ºå®‰å…¨çš„æ‰§è¡Œç¯å¢ƒ
</span>                <span class="n">safe_context</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="sh">'</span><span class="s">__builtins__</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">safe_builtins</span><span class="p">,</span>
                    <span class="sh">'</span><span class="s">output</span><span class="sh">'</span><span class="p">:</span> <span class="n">output_buffer</span><span class="p">,</span>
                    <span class="sh">'</span><span class="s">print_to_template</span><span class="sh">'</span><span class="p">:</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">output_buffer</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">'</span><span class="s"> </span><span class="sh">'</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">)),</span>
                    <span class="o">**</span><span class="n">context</span>
                <span class="p">}</span>
                
                <span class="c1"># æ‰§è¡Œä»£ç å—
</span>                <span class="nf">exec</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">safe_context</span><span class="p">,</span> <span class="p">{})</span>
                
                <span class="c1"># è¿”å›è¾“å‡º
</span>                <span class="k">return</span> <span class="sh">'</span><span class="se">\n</span><span class="sh">'</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">output_buffer</span><span class="p">)</span>
            <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">return</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="o">%</span> <span class="n">ERROR</span><span class="si">:</span> <span class="si">{</span><span class="n">e</span><span class="si">}</span> <span class="o">%</span><span class="si">}</span><span class="sh">"</span>
        
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">code_block_pattern</span><span class="p">.</span><span class="nf">sub</span><span class="p">(</span><span class="n">replace_code_block</span><span class="p">,</span> <span class="n">template</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">render_file_template</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">template_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">æ¸²æŸ“æ–‡ä»¶æ¨¡æ¿</span><span class="sh">"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">template_path</span><span class="p">,</span> <span class="sh">'</span><span class="s">r</span><span class="sh">'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">template</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="nf">read</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">render_template</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nc">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">æ¸²æŸ“æ¨¡æ¿æ–‡ä»¶å¤±è´¥: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># æµ‹è¯•æ¨¡æ¿å¼•æ“
</span><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">æ¨¡æ¿å¼•æ“ç¤ºä¾‹:</span><span class="sh">"</span><span class="p">)</span>

<span class="n">template_engine</span> <span class="o">=</span> <span class="nc">TemplateEngine</span><span class="p">()</span>

<span class="c1"># ç®€å•å˜é‡æ¨¡æ¿
</span><span class="n">simple_template</span> <span class="o">=</span> <span class="sh">"""</span><span class="s">
æ¬¢è¿ !
æ‚¨çš„å¹´é¾„æ˜¯  å²ã€‚
æ‚¨çš„åˆ†æ•°æ˜¯ ï¼Œç­‰çº§æ˜¯ Aã€‚
</span><span class="sh">"""</span>

<span class="n">simple_context</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">å¼ ä¸‰</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">age</span><span class="sh">'</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">score</span><span class="sh">'</span><span class="p">:</span> <span class="mi">95</span>
<span class="p">}</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">ç®€å•å˜é‡æ¨¡æ¿:</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">template_engine</span><span class="p">.</span><span class="nf">render_template</span><span class="p">(</span><span class="n">simple_template</span><span class="p">,</span> <span class="n">simple_context</span><span class="p">))</span>

<span class="c1"># å¾ªç¯æ¨¡æ¿
</span>
<span class="n">loop_template</span> <span class="o">=</span> <span class="sh">"""</span><span class="s">
å­¦ç”Ÿåˆ—è¡¨:
{% 
for i, student in enumerate(students):
    grade = </span><span class="sh">'</span><span class="s">A</span><span class="sh">'</span><span class="s"> if student[</span><span class="sh">'</span><span class="s">score</span><span class="sh">'</span><span class="s">] &gt;= 90 else </span><span class="sh">'</span><span class="s">B</span><span class="sh">'</span><span class="s"> if student[</span><span class="sh">'</span><span class="s">score</span><span class="sh">'</span><span class="s">] &gt;= 80 else </span><span class="sh">'</span><span class="s">C</span><span class="sh">'</span><span class="s">
    print_to_template(f</span><span class="sh">"</span><span class="s">{i+1}. {student[</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="s">]}: {student[</span><span class="sh">'</span><span class="s">score</span><span class="sh">'</span><span class="s">]} ({grade})</span><span class="sh">"</span><span class="s">)
%}

ç»Ÿè®¡ä¿¡æ¯:
- æ€»äººæ•°: {{ len(students) }}
- å¹³å‡åˆ†: {{ sum(s[</span><span class="sh">'</span><span class="s">score</span><span class="sh">'</span><span class="s">] for s in students) / len(students) }}
- æœ€é«˜åˆ†: {{ max(s[</span><span class="sh">'</span><span class="s">score</span><span class="sh">'</span><span class="s">] for s in students) }}
- æœ€ä½åˆ†: {{ min(s[</span><span class="sh">'</span><span class="s">score</span><span class="sh">'</span><span class="s">] for s in students) }}
</span><span class="sh">"""</span>

<span class="n">loop_context</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">'</span><span class="s">students</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Alice</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">score</span><span class="sh">'</span><span class="p">:</span> <span class="mi">95</span><span class="p">},</span>
        <span class="p">{</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Bob</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">score</span><span class="sh">'</span><span class="p">:</span> <span class="mi">87</span><span class="p">},</span>
        <span class="p">{</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Charlie</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">score</span><span class="sh">'</span><span class="p">:</span> <span class="mi">92</span><span class="p">},</span>
        <span class="p">{</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">David</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">score</span><span class="sh">'</span><span class="p">:</span> <span class="mi">78</span><span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="s">å¾ªç¯æ¨¡æ¿:</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">template_engine</span><span class="p">.</span><span class="nf">render_template</span><span class="p">(</span><span class="n">loop_template</span><span class="p">,</span> <span class="n">loop_context</span><span class="p">))</span>

<span class="c1"># æ¡ä»¶æ¨¡æ¿
</span><span class="n">conditional_template</span> <span class="o">=</span> <span class="sh">"""</span><span class="s">
{# è¿™æ˜¯æ³¨é‡Šï¼Œä¸ä¼šæ˜¾ç¤º #}
ç³»ç»ŸçŠ¶æ€æŠ¥å‘Š
==================

{% 
if system_status == </span><span class="sh">'</span><span class="s">healthy</span><span class="sh">'</span><span class="s">:
    print_to_template(</span><span class="sh">"</span><span class="s">âœ… ç³»ç»Ÿè¿è¡Œæ­£å¸¸</span><span class="sh">"</span><span class="s">)
    print_to_template(f</span><span class="sh">"</span><span class="s">CPUä½¿ç”¨ç‡: {cpu_usage}%</span><span class="sh">"</span><span class="s">)
    print_to_template(f</span><span class="sh">"</span><span class="s">å†…å­˜ä½¿ç”¨ç‡: {memory_usage}%</span><span class="sh">"</span><span class="s">)
else:
    print_to_template(</span><span class="sh">"</span><span class="s">âŒ ç³»ç»Ÿå¼‚å¸¸</span><span class="sh">"</span><span class="s">)
    print_to_template(f</span><span class="sh">"</span><span class="s">é”™è¯¯ä¿¡æ¯: {error_message}</span><span class="sh">"</span><span class="s">)
%}

æœåŠ¡çŠ¶æ€:
{% 
for service, status in services.items():
    icon = </span><span class="sh">'</span><span class="s">ğŸŸ¢</span><span class="sh">'</span><span class="s"> if status == </span><span class="sh">'</span><span class="s">running</span><span class="sh">'</span><span class="s"> else </span><span class="sh">'</span><span class="s">ğŸ”´</span><span class="sh">'</span><span class="s">
    print_to_template(f</span><span class="sh">"</span><span class="s">{icon} {service}: {status}</span><span class="sh">"</span><span class="s">)
%}

{% 
if alerts:
    print_to_template(</span><span class="sh">"</span><span class="se">\n</span><span class="s">âš ï¸ è­¦å‘Šä¿¡æ¯:</span><span class="sh">"</span><span class="s">)
    for alert in alerts:
        print_to_template(f</span><span class="sh">"</span><span class="s">- {alert}</span><span class="sh">"</span><span class="s">)
else:
    print_to_template(</span><span class="sh">"</span><span class="se">\n</span><span class="s">âœ… æ— è­¦å‘Šä¿¡æ¯</span><span class="sh">"</span><span class="s">)
%}
</span><span class="sh">"""</span>

<span class="n">conditional_context</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">'</span><span class="s">system_status</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">healthy</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">cpu_usage</span><span class="sh">'</span><span class="p">:</span> <span class="mi">45</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">memory_usage</span><span class="sh">'</span><span class="p">:</span> <span class="mi">67</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">services</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span>
        <span class="sh">'</span><span class="s">web_server</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">running</span><span class="sh">'</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">database</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">running</span><span class="sh">'</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">cache</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">stopped</span><span class="sh">'</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">queue</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">running</span><span class="sh">'</span>
    <span class="p">},</span>
    <span class="sh">'</span><span class="s">alerts</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span>
        <span class="sh">'</span><span class="s">ç¼“å­˜æœåŠ¡å·²åœæ­¢</span><span class="sh">'</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">ç£ç›˜ç©ºé—´ä¸è¶³ (85% å·²ä½¿ç”¨)</span><span class="sh">'</span>
    <span class="p">]</span>
<span class="p">}</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="s">æ¡ä»¶æ¨¡æ¿:</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">template_engine</span><span class="p">.</span><span class="nf">render_template</span><span class="p">(</span><span class="n">conditional_template</span><span class="p">,</span> <span class="n">conditional_context</span><span class="p">))</span>

<span class="c1"># å¤æ‚æ•°æ®å¤„ç†æ¨¡æ¿
</span><span class="n">complex_template</span> <span class="o">=</span> <span class="sh">"""</span><span class="s">
HTMLæŠ¥å‘Šç”Ÿæˆ
=============

{% 
# æ•°æ®é¢„å¤„ç†
total_sales = sum(item[</span><span class="sh">'</span><span class="s">amount</span><span class="sh">'</span><span class="s">] for item in sales_data)
average_sale = total_sales / len(sales_data) if sales_data else 0
top_products = sorted(sales_data, key=lambda x: x[</span><span class="sh">'</span><span class="s">amount</span><span class="sh">'</span><span class="s">], reverse=True)[:3]

# æŒ‰ç±»åˆ«åˆ†ç»„
category_sales = {}
for item in sales_data:
    category = item[</span><span class="sh">'</span><span class="s">category</span><span class="sh">'</span><span class="s">]
    if category not in category_sales:
        category_sales[category] = []
    category_sales[category].append(item)

# ç”ŸæˆæŠ¥å‘Š
print_to_template(f</span><span class="sh">"</span><span class="s">é”€å”®æ€»é¢: ${total_sales:,.2f}</span><span class="sh">"</span><span class="s">)
print_to_template(f</span><span class="sh">"</span><span class="s">å¹³å‡é”€å”®é¢: ${average_sale:,.2f}</span><span class="sh">"</span><span class="s">)
print_to_template(f</span><span class="sh">"</span><span class="s">äº¤æ˜“æ•°é‡: {len(sales_data)}</span><span class="sh">"</span><span class="s">)
print_to_template(</span><span class="sh">""</span><span class="s">)
print_to_template(</span><span class="sh">"</span><span class="s">å‰ä¸‰åäº§å“:</span><span class="sh">"</span><span class="s">)
for i, product in enumerate(top_products, 1):
    print_to_template(f</span><span class="sh">"</span><span class="s">{i}. {product[</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="s">]}: ${product[</span><span class="sh">'</span><span class="s">amount</span><span class="sh">'</span><span class="s">]:,.2f}</span><span class="sh">"</span><span class="s">)

print_to_template(</span><span class="sh">""</span><span class="s">)
print_to_template(</span><span class="sh">"</span><span class="s">æŒ‰ç±»åˆ«ç»Ÿè®¡:</span><span class="sh">"</span><span class="s">)
for category, items in category_sales.items():
    category_total = sum(item[</span><span class="sh">'</span><span class="s">amount</span><span class="sh">'</span><span class="s">] for item in items)
    print_to_template(f</span><span class="sh">"</span><span class="s">{category}: ${category_total:,.2f} ({len(items)} é¡¹)</span><span class="sh">"</span><span class="s">)
%}
</span><span class="sh">"""</span>

<span class="n">complex_context</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">'</span><span class="s">sales_data</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">ç¬”è®°æœ¬ç”µè„‘</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">category</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">ç”µå­äº§å“</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">amount</span><span class="sh">'</span><span class="p">:</span> <span class="mf">1299.99</span><span class="p">},</span>
        <span class="p">{</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">æ‰‹æœº</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">category</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">ç”µå­äº§å“</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">amount</span><span class="sh">'</span><span class="p">:</span> <span class="mf">899.99</span><span class="p">},</span>
        <span class="p">{</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">åŠå…¬æ¤…</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">category</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">å®¶å…·</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">amount</span><span class="sh">'</span><span class="p">:</span> <span class="mf">299.99</span><span class="p">},</span>
        <span class="p">{</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">é”®ç›˜</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">category</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">ç”µå­äº§å“</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">amount</span><span class="sh">'</span><span class="p">:</span> <span class="mf">79.99</span><span class="p">},</span>
        <span class="p">{</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">ä¹¦æ¡Œ</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">category</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">å®¶å…·</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">amount</span><span class="sh">'</span><span class="p">:</span> <span class="mf">399.99</span><span class="p">},</span>
        <span class="p">{</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">æ˜¾ç¤ºå™¨</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">category</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">ç”µå­äº§å“</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">amount</span><span class="sh">'</span><span class="p">:</span> <span class="mf">249.99</span><span class="p">},</span>
        <span class="p">{</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">å°ç¯</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">category</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">å®¶å…·</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">amount</span><span class="sh">'</span><span class="p">:</span> <span class="mf">49.99</span><span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="s">å¤æ‚æ•°æ®å¤„ç†æ¨¡æ¿:</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">template_engine</span><span class="p">.</span><span class="nf">render_template</span><span class="p">(</span><span class="n">complex_template</span><span class="p">,</span> <span class="n">complex_context</span><span class="p">))</span>

</code></pre></div></div>

<h2 id="ï¸-å¸¸è§é™·é˜±ä¸æœ€ä½³å®è·µ">âš ï¸ å¸¸è§é™·é˜±ä¸æœ€ä½³å®è·µ</h2>

<h3 id="å®‰å…¨é£é™©é˜²æŠ¤">å®‰å…¨é£é™©é˜²æŠ¤</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># å®‰å…¨é£é™©é˜²æŠ¤ç¤ºä¾‹
</span><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">å®‰å…¨é£é™©é˜²æŠ¤ç¤ºä¾‹:</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># å®‰å…¨çš„execåŒ…è£…å™¨
</span><span class="k">class</span> <span class="nc">SecureExecutor</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">å®‰å…¨çš„ä»£ç æ‰§è¡Œå™¨</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="c1"># å±é™©å…³é”®è¯
</span>        <span class="n">self</span><span class="p">.</span><span class="n">dangerous_keywords</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">import</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">exec</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">eval</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">compile</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">open</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">file</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">__import__</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">__builtins__</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">__globals__</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">__locals__</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">globals</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">locals</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">vars</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">dir</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">hasattr</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">getattr</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">setattr</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">delattr</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">input</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">raw_input</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">reload</span><span class="sh">'</span>
        <span class="p">}</span>
        
        <span class="c1"># å±é™©æ¨¡å—
</span>        <span class="n">self</span><span class="p">.</span><span class="n">dangerous_modules</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">os</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">sys</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">subprocess</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">shutil</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">tempfile</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">pickle</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">marshal</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">shelve</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">dbm</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">sqlite3</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">socket</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">urllib</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">http</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">ftplib</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">smtplib</span><span class="sh">'</span>
        <span class="p">}</span>
        
        <span class="c1"># å®‰å…¨çš„å†…ç½®å‡½æ•°
</span>        <span class="n">self</span><span class="p">.</span><span class="n">safe_builtins</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">abs</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">all</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">any</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">bin</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">bool</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">chr</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">dict</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">enumerate</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">filter</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">float</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">hex</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">int</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">len</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">list</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">map</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">max</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">min</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">oct</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">ord</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">range</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">reversed</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">round</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">set</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">sorted</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">str</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">sum</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">tuple</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">zip</span><span class="sh">'</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">is_safe_code</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="sh">"""</span><span class="s">æ£€æŸ¥ä»£ç æ˜¯å¦å®‰å…¨</span><span class="sh">"""</span>
        <span class="c1"># æ£€æŸ¥å±é™©å…³é”®è¯
</span>        <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">dangerous_keywords</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">code</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span><span class="p">,</span> <span class="sa">f</span><span class="sh">"</span><span class="s">åŒ…å«å±é™©å…³é”®è¯: </span><span class="si">{</span><span class="n">keyword</span><span class="si">}</span><span class="sh">"</span>
        
        <span class="c1"># æ£€æŸ¥å±é™©æ¨¡å—
</span>        <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">dangerous_modules</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="n">code</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span><span class="p">,</span> <span class="sa">f</span><span class="sh">"</span><span class="s">å°è¯•è®¿é—®å±é™©æ¨¡å—: </span><span class="si">{</span><span class="n">module</span><span class="si">}</span><span class="sh">"</span>
        
        <span class="c1"># æ£€æŸ¥åŒä¸‹åˆ’çº¿å±æ€§
</span>        <span class="k">if</span> <span class="sh">'</span><span class="s">__</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">code</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span><span class="p">,</span> <span class="sh">"</span><span class="s">åŒ…å«åŒä¸‹åˆ’çº¿å±æ€§è®¿é—®</span><span class="sh">"</span>
        
        <span class="c1"># æ£€æŸ¥ç‚¹å·è®¿é—®ï¼ˆå¯èƒ½çš„å±æ€§è®¿é—®ï¼‰
</span>        <span class="k">if</span> <span class="sh">'</span><span class="s">.</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">code</span> <span class="ow">and</span> <span class="nf">any</span><span class="p">(</span><span class="n">dangerous</span> <span class="ow">in</span> <span class="n">code</span> <span class="k">for</span> <span class="n">dangerous</span> <span class="ow">in</span> <span class="p">[</span><span class="sh">'</span><span class="s">class</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">base</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">subclass</span><span class="sh">'</span><span class="p">]):</span>
            <span class="k">return</span> <span class="bp">False</span><span class="p">,</span> <span class="sh">"</span><span class="s">å¯èƒ½çš„å±é™©å±æ€§è®¿é—®</span><span class="sh">"</span>
        
        <span class="k">return</span> <span class="bp">True</span><span class="p">,</span> <span class="sh">"</span><span class="s">ä»£ç å®‰å…¨</span><span class="sh">"</span>
    
    <span class="k">def</span> <span class="nf">create_safe_environment</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">allowed_vars</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sh">"""</span><span class="s">åˆ›å»ºå®‰å…¨çš„æ‰§è¡Œç¯å¢ƒ</span><span class="sh">"""</span>
        <span class="c1"># åˆ›å»ºå—é™çš„å†…ç½®å‡½æ•°å­—å…¸
</span>        <span class="n">restricted_builtins</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">safe_builtins</span><span class="p">:</span>
            <span class="k">if</span> <span class="nf">hasattr</span><span class="p">(</span><span class="n">__builtins__</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
                <span class="n">restricted_builtins</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">__builtins__</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        
        <span class="c1"># åŸºç¡€ç¯å¢ƒ
</span>        <span class="n">safe_env</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">__builtins__</span><span class="sh">'</span><span class="p">:</span> <span class="n">restricted_builtins</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">__name__</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">__restricted__</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">__doc__</span><span class="sh">'</span><span class="p">:</span> <span class="bp">None</span>
        <span class="p">}</span>
        
        <span class="c1"># æ·»åŠ å…è®¸çš„å˜é‡
</span>        <span class="k">if</span> <span class="n">allowed_vars</span><span class="p">:</span>
            <span class="n">safe_env</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">allowed_vars</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">safe_env</span>
    
    <span class="k">def</span> <span class="nf">safe_exec</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">allowed_vars</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sh">"""</span><span class="s">å®‰å…¨åœ°æ‰§è¡Œä»£ç </span><span class="sh">"""</span>
        <span class="c1"># æ£€æŸ¥ä»£ç å®‰å…¨æ€§
</span>        <span class="n">is_safe</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">is_safe_code</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_safe</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nc">SecurityError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">ä¸å®‰å…¨çš„ä»£ç : </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># åˆ›å»ºå®‰å…¨ç¯å¢ƒ
</span>        <span class="n">safe_globals</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">create_safe_environment</span><span class="p">(</span><span class="n">allowed_vars</span><span class="p">)</span>
        <span class="n">safe_locals</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># æ‰§è¡Œä»£ç 
</span>            <span class="nf">exec</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">safe_globals</span><span class="p">,</span> <span class="n">safe_locals</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">safe_locals</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nc">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">ä»£ç æ‰§è¡Œå¤±è´¥: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># è‡ªå®šä¹‰å®‰å…¨å¼‚å¸¸
</span><span class="k">class</span> <span class="nc">SecurityError</span><span class="p">(</span><span class="nb">Exception</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">å®‰å…¨å¼‚å¸¸</span><span class="sh">"""</span>
    <span class="k">pass</span>

<span class="c1"># æµ‹è¯•å®‰å…¨æ‰§è¡Œå™¨
</span><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">å®‰å…¨æ‰§è¡Œå™¨æµ‹è¯•:</span><span class="sh">"</span><span class="p">)</span>

<span class="n">secure_executor</span> <span class="o">=</span> <span class="nc">SecureExecutor</span><span class="p">()</span>

<span class="c1"># å®‰å…¨ä»£ç æµ‹è¯•
</span><span class="n">safe_codes</span> <span class="o">=</span> <span class="p">[</span>
    <span class="sh">"</span><span class="s">x = 10</span><span class="se">\n</span><span class="s">y = 20</span><span class="se">\n</span><span class="s">result = x + y</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">numbers = [1, 2, 3, 4, 5]</span><span class="se">\n</span><span class="s">total = sum(numbers)</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">text = </span><span class="sh">'</span><span class="s">Hello World</span><span class="sh">'</span><span class="se">\n</span><span class="s">length = len(text)</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">data = [1, 2, 3]</span><span class="se">\n</span><span class="s">filtered = list(filter(lambda x: x &gt; 1, data))</span><span class="sh">"</span>
<span class="p">]</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">å®‰å…¨ä»£ç æµ‹è¯•:</span><span class="sh">"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">code</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">safe_codes</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">secure_executor</span><span class="p">.</span><span class="nf">safe_exec</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  æµ‹è¯• </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s">: æˆåŠŸ</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">    å˜é‡: </span><span class="si">{</span><span class="nf">list</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="nf">keys</span><span class="p">())</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  æµ‹è¯• </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s">: å¤±è´¥ - </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># å±é™©ä»£ç æµ‹è¯•
</span><span class="n">dangerous_codes</span> <span class="o">=</span> <span class="p">[</span>
    <span class="sh">"</span><span class="s">import os</span><span class="se">\n</span><span class="s">os.system(</span><span class="sh">'</span><span class="s">ls</span><span class="sh">'</span><span class="s">)</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">exec(</span><span class="sh">'</span><span class="s">print(</span><span class="se">\"</span><span class="s">hello</span><span class="se">\"</span><span class="s">)</span><span class="sh">'</span><span class="s">)</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">open(</span><span class="sh">'</span><span class="s">/etc/passwd</span><span class="sh">'</span><span class="s">).read()</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">__import__(</span><span class="sh">'</span><span class="s">subprocess</span><span class="sh">'</span><span class="s">).call([</span><span class="sh">'</span><span class="s">ls</span><span class="sh">'</span><span class="s">])</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">[].append.__globals__[</span><span class="sh">'</span><span class="s">__builtins__</span><span class="sh">'</span><span class="s">][</span><span class="sh">'</span><span class="s">eval</span><span class="sh">'</span><span class="s">](</span><span class="sh">'</span><span class="s">1+1</span><span class="sh">'</span><span class="s">)</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">().__class__.__bases__[0].__subclasses__()</span><span class="sh">"</span>
<span class="p">]</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="s">å±é™©ä»£ç æµ‹è¯•:</span><span class="sh">"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">code</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">dangerous_codes</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">secure_executor</span><span class="p">.</span><span class="nf">safe_exec</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  æµ‹è¯• </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s">: æˆåŠŸï¼ˆä¸åº”è¯¥æˆåŠŸ!ï¼‰</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">SecurityError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  æµ‹è¯• </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s">: è¢«å®‰å…¨æœºåˆ¶é˜»æ­¢ - </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  æµ‹è¯• </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s">: å…¶ä»–é”™è¯¯ - </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># èµ„æºé™åˆ¶
</span><span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="s">èµ„æºé™åˆ¶ç¤ºä¾‹:</span><span class="sh">"</span><span class="p">)</span>

<span class="kn">import</span> <span class="n">signal</span>
<span class="kn">import</span> <span class="n">time</span>

<span class="k">class</span> <span class="nc">ResourceLimitedExecutor</span><span class="p">(</span><span class="n">SecureExecutor</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">èµ„æºå—é™çš„æ‰§è¡Œå™¨</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">max_memory</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">):</span>  <span class="c1"># 100MB
</span>        <span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>
        <span class="n">self</span><span class="p">.</span><span class="n">max_memory</span> <span class="o">=</span> <span class="n">max_memory</span>
    
    <span class="k">def</span> <span class="nf">timeout_handler</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">signum</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">è¶…æ—¶å¤„ç†å™¨</span><span class="sh">"""</span>
        <span class="k">raise</span> <span class="nc">TimeoutError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">ä»£ç æ‰§è¡Œè¶…æ—¶ (</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">timeout</span><span class="si">}</span><span class="s">ç§’)</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">safe_exec_with_limits</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">allowed_vars</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sh">"""</span><span class="s">å¸¦èµ„æºé™åˆ¶çš„å®‰å…¨æ‰§è¡Œ</span><span class="sh">"""</span>
        <span class="c1"># è®¾ç½®è¶…æ—¶
</span>        <span class="n">old_handler</span> <span class="o">=</span> <span class="n">signal</span><span class="p">.</span><span class="nf">signal</span><span class="p">(</span><span class="n">signal</span><span class="p">.</span><span class="n">SIGALRM</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">timeout_handler</span><span class="p">)</span>
        <span class="n">signal</span><span class="p">.</span><span class="nf">alarm</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">timeout</span><span class="p">)</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># è®°å½•å¼€å§‹æ—¶é—´
</span>            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
            
            <span class="c1"># æ‰§è¡Œä»£ç 
</span>            <span class="n">result</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">safe_exec</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">allowed_vars</span><span class="p">)</span>
            
            <span class="c1"># è®°å½•æ‰§è¡Œæ—¶é—´
</span>            <span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
            <span class="n">result</span><span class="p">[</span><span class="sh">'</span><span class="s">__execution_time__</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">execution_time</span>
            
            <span class="k">return</span> <span class="n">result</span>
            
        <span class="k">finally</span><span class="p">:</span>
            <span class="c1"># æ¢å¤ä¿¡å·å¤„ç†å™¨
</span>            <span class="n">signal</span><span class="p">.</span><span class="nf">alarm</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">signal</span><span class="p">.</span><span class="nf">signal</span><span class="p">(</span><span class="n">signal</span><span class="p">.</span><span class="n">SIGALRM</span><span class="p">,</span> <span class="n">old_handler</span><span class="p">)</span>

<span class="c1"># æµ‹è¯•èµ„æºé™åˆ¶ï¼ˆåœ¨æ”¯æŒä¿¡å·çš„ç³»ç»Ÿä¸Šï¼‰
</span><span class="k">try</span><span class="p">:</span>
    <span class="n">limited_executor</span> <span class="o">=</span> <span class="nc">ResourceLimitedExecutor</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="c1"># æ­£å¸¸ä»£ç 
</span>    <span class="n">normal_code</span> <span class="o">=</span> <span class="sh">"""</span><span class="s">
result = 0
for i in range(1000):
    result += i
</span><span class="sh">"""</span>
    
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">æ­£å¸¸ä»£ç æ‰§è¡Œ:</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">limited_executor</span><span class="p">.</span><span class="nf">safe_exec_with_limits</span><span class="p">(</span><span class="n">normal_code</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  æ‰§è¡Œæ—¶é—´: </span><span class="si">{</span><span class="n">result</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">__execution_time__</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="si">:</span><span class="p">.</span><span class="mi">4</span><span class="n">f</span><span class="si">}</span><span class="s">ç§’</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  ç»“æœ: </span><span class="si">{</span><span class="n">result</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">result</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">N/A</span><span class="sh">'</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="c1"># å¯èƒ½è¶…æ—¶çš„ä»£ç ï¼ˆæ³¨é‡Šæ‰ä»¥é¿å…å®é™…è¶…æ—¶ï¼‰
</span>    <span class="c1"># timeout_code = """
</span>    <span class="c1"># import time
</span>    <span class="c1"># time.sleep(10)  # è¿™ä¼šè¶…æ—¶
</span>    <span class="c1"># """
</span>    <span class="c1"># 
</span>    <span class="c1"># print("\nè¶…æ—¶ä»£ç æµ‹è¯•:")
</span>    <span class="c1"># try:
</span>    <span class="c1">#     result = limited_executor.safe_exec_with_limits(timeout_code)
</span>    <span class="c1"># except TimeoutError as e:
</span>    <span class="c1">#     print(f"  è¶…æ—¶è¢«æ•è·: {e}")
</span>    
<span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">èµ„æºé™åˆ¶æµ‹è¯•è·³è¿‡ï¼ˆå¯èƒ½ä¸æ”¯æŒä¿¡å·ï¼‰: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="-ç›¸å…³å‡½æ•°å’Œæ¨¡å—">ğŸ“š ç›¸å…³å‡½æ•°å’Œæ¨¡å—</h2>

<h3 id="å†…ç½®å‡½æ•°">å†…ç½®å‡½æ•°</h3>
<ul>
  <li><code class="language-plaintext highlighter-rouge">eval()</code> - æ‰§è¡ŒPythonè¡¨è¾¾å¼</li>
  <li><code class="language-plaintext highlighter-rouge">compile()</code> - ç¼–è¯‘Pythonä»£ç </li>
  <li><code class="language-plaintext highlighter-rouge">globals()</code> - è·å–å…¨å±€å‘½åç©ºé—´</li>
  <li><code class="language-plaintext highlighter-rouge">locals()</code> - è·å–å±€éƒ¨å‘½åç©ºé—´</li>
  <li><code class="language-plaintext highlighter-rouge">vars()</code> - è·å–å¯¹è±¡çš„å±æ€§å­—å…¸</li>
  <li><code class="language-plaintext highlighter-rouge">dir()</code> - åˆ—å‡ºå¯¹è±¡çš„å±æ€§</li>
  <li><code class="language-plaintext highlighter-rouge">hasattr()</code> - æ£€æŸ¥å±æ€§æ˜¯å¦å­˜åœ¨</li>
  <li><code class="language-plaintext highlighter-rouge">getattr()</code> - è·å–å±æ€§å€¼</li>
  <li><code class="language-plaintext highlighter-rouge">setattr()</code> - è®¾ç½®å±æ€§å€¼</li>
  <li><code class="language-plaintext highlighter-rouge">delattr()</code> - åˆ é™¤å±æ€§</li>
</ul>

<h3 id="æ ‡å‡†åº“æ¨¡å—">æ ‡å‡†åº“æ¨¡å—</h3>
<ul>
  <li><code class="language-plaintext highlighter-rouge">ast</code> - æŠ½è±¡è¯­æ³•æ ‘</li>
  <li><code class="language-plaintext highlighter-rouge">code</code> - äº¤äº’å¼è§£é‡Šå™¨</li>
  <li><code class="language-plaintext highlighter-rouge">codeop</code> - ç¼–è¯‘Pythonä»£ç </li>
  <li><code class="language-plaintext highlighter-rouge">dis</code> - å­—èŠ‚ç åæ±‡ç¼–</li>
  <li><code class="language-plaintext highlighter-rouge">inspect</code> - å¯¹è±¡æ£€æŸ¥</li>
  <li><code class="language-plaintext highlighter-rouge">types</code> - åŠ¨æ€ç±»å‹åˆ›å»º</li>
  <li><code class="language-plaintext highlighter-rouge">importlib</code> - å¯¼å…¥æœºåˆ¶</li>
  <li><code class="language-plaintext highlighter-rouge">runpy</code> - è¿è¡ŒPythonæ¨¡å—</li>
  <li><code class="language-plaintext highlighter-rouge">traceback</code> - å¼‚å¸¸è·Ÿè¸ª</li>
</ul>

<h3 id="ç¬¬ä¸‰æ–¹åº“">ç¬¬ä¸‰æ–¹åº“</h3>
<ul>
  <li><code class="language-plaintext highlighter-rouge">RestrictedPython</code> - å—é™çš„Pythonæ‰§è¡Œ</li>
  <li><code class="language-plaintext highlighter-rouge">asteval</code> - å®‰å…¨çš„è¡¨è¾¾å¼æ±‚å€¼</li>
  <li><code class="language-plaintext highlighter-rouge">PyPy</code> - Pythonè§£é‡Šå™¨</li>
  <li><code class="language-plaintext highlighter-rouge">Jinja2</code> - æ¨¡æ¿å¼•æ“</li>
  <li><code class="language-plaintext highlighter-rouge">Mako</code> - æ¨¡æ¿å¼•æ“</li>
</ul>

<h2 id="-æ‰©å±•é˜…è¯»">ğŸ“– æ‰©å±•é˜…è¯»</h2>

<ol>
  <li><strong>Pythonå®˜æ–¹æ–‡æ¡£</strong>
    <ul>
      <li><a href="https://docs.python.org/3/library/functions.html#exec">Built-in Functions - exec()</a></li>
      <li><a href="https://docs.python.org/3/reference/datamodel.html#code-objects">Code Objects</a></li>
    </ul>
  </li>
  <li><strong>å®‰å…¨ç›¸å…³</strong>
    <ul>
      <li>Pythonä»£ç æ³¨å…¥æ”»å‡»é˜²æŠ¤</li>
      <li>æ²™ç®±æ‰§è¡Œç¯å¢ƒè®¾è®¡</li>
      <li>å®‰å…¨ç¼–ç¨‹æœ€ä½³å®è·µ</li>
    </ul>
  </li>
  <li><strong>é«˜çº§åº”ç”¨</strong>
    <ul>
      <li>åŠ¨æ€ä»£ç ç”ŸæˆæŠ€æœ¯</li>
      <li>æ’ä»¶ç³»ç»Ÿè®¾è®¡</li>
      <li>æ¨¡æ¿å¼•æ“å®ç°</li>
    </ul>
  </li>
</ol>

<h2 id="ï¸-æ ‡ç­¾">ğŸ·ï¸ æ ‡ç­¾</h2>

<p><code class="language-plaintext highlighter-rouge">ä»£ç æ‰§è¡Œ</code> <code class="language-plaintext highlighter-rouge">åŠ¨æ€æ‰§è¡Œ</code> <code class="language-plaintext highlighter-rouge">è¯­å¥æ‰§è¡Œ</code> <code class="language-plaintext highlighter-rouge">å®‰å…¨é£é™©</code> <code class="language-plaintext highlighter-rouge">æ’ä»¶ç³»ç»Ÿ</code> <code class="language-plaintext highlighter-rouge">æ¨¡æ¿å¼•æ“</code> <code class="language-plaintext highlighter-rouge">ä»£ç ç”Ÿæˆ</code> <code class="language-plaintext highlighter-rouge">æ²™ç®±æ‰§è¡Œ</code> <code class="language-plaintext highlighter-rouge">èµ„æºé™åˆ¶</code> <code class="language-plaintext highlighter-rouge">å®‰å…¨ç¼–ç¨‹</code></p>

      </div>
      
      <!-- æ–‡æ¡£åº•éƒ¨ -->
      <footer class="doc-footer">
        
        <p class="doc-author">ä½œè€…: Pythonæ–‡æ¡£å·¥ç¨‹å¸ˆ</p>
        
        
        
        <p class="doc-version">ç‰ˆæœ¬: 1.0</p>
        
      </footer>
    </article>
  </main>
  
  <!-- å³ä¾§å¯¼èˆªæ  -->
  <aside class="doc-sidebar">
    <div class="toc-container">
      <h3>ç›®å½•</h3>
      <div id="toc"></div>
    </div>
    
    <!-- ç›¸å…³é“¾æ¥ -->
    <div class="related-links">
      <h3>ç›¸å…³å†…å®¹</h3>
      <ul>
        
        
      </ul>
    </div>
  </aside>
</div>

<!-- utterancesè¯„è®ºç³»ç»Ÿ -->
<div class="comments-section">
  <h3 class="comments-title">
    <i class="fas fa-comments"></i>
    è®¨è®ºä¸åé¦ˆ
  </h3>
  <div class="comments-description">
    <p>æ¬¢è¿åœ¨ä¸‹æ–¹ç•™è¨€è®¨è®ºï¼Œåˆ†äº«ä½ çš„å­¦ä¹ å¿ƒå¾—æˆ–æå‡ºé—®é¢˜ã€‚è¯„è®ºåŸºäºGitHub Issuesï¼Œéœ€è¦GitHubè´¦å·ã€‚</p>
  </div>
  <div id="utterances-container">
    <script src="https://utteranc.es/client.js"
            repo="username/PythonModelBook"
            issue-term="pathname"
            theme="preferred-color-scheme"
            crossorigin="anonymous"
            async>
    </script>
  </div>
  

</div>

<style>
.doc-container {
  display: flex;
  max-width: 1200px;
  margin: 0 auto;
  gap: 2rem;
}

.doc-content {
  flex: 1;
  min-width: 0;
}

.doc-header {
  border-bottom: 1px solid #e1e4e8;
  padding-bottom: 1rem;
  margin-bottom: 2rem;
}

.doc-title {
  font-size: 2.5rem;
  margin-bottom: 0.5rem;
  color: #24292e;
}

.doc-description {
  font-size: 1.2rem;
  color: #586069;
  margin-bottom: 1rem;
}

.doc-meta {
  display: flex;
  gap: 1rem;
  margin-bottom: 1rem;
  font-size: 0.9rem;
  color: #586069;
}

.doc-tags {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
}

.tag {
  background: #f1f8ff;
  color: #0366d6;
  padding: 0.25rem 0.5rem;
  border-radius: 3px;
  font-size: 0.8rem;
}

.doc-body {
  line-height: 1.6;
}

.doc-body h2 {
  border-bottom: 1px solid #e1e4e8;
  padding-bottom: 0.3rem;
  margin-top: 2rem;
  margin-bottom: 1rem;
}

.doc-body pre {
  background: #f6f8fa;
  padding: 1rem;
  border-radius: 6px;
  overflow-x: auto;
}

.doc-body table {
  border-collapse: collapse;
  width: 100%;
  margin: 1rem 0;
}

.doc-body th,
.doc-body td {
  border: 1px solid #d0d7de;
  padding: 0.5rem;
  text-align: left;
}

.doc-body th {
  background: #f6f8fa;
  font-weight: 600;
}

.doc-sidebar {
  width: 300px;
  position: sticky;
  top: 2rem;
  height: fit-content;
}

.toc-container,
.related-links {
  background: #f6f8fa;
  padding: 1rem;
  border-radius: 6px;
  margin-bottom: 1rem;
}

.toc-container h3,
.related-links h3 {
  margin-top: 0;
  margin-bottom: 1rem;
  font-size: 1.1rem;
}

.related-links ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.related-links li {
  margin-bottom: 0.5rem;
}

.related-links a {
  color: #0366d6;
  text-decoration: none;
}

.related-links a:hover {
  text-decoration: underline;
}

.comments-section {
  max-width: 1200px;
  margin: 2rem auto;
  margin-top: 3rem;
  padding: 2rem;
  background: var(--bg-secondary, #f6f8fa);
  border-radius: var(--radius-xl, 12px);
  border: 1px solid var(--border-color, #e1e4e8);
}

.comments-title {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 1rem;
  color: var(--text-primary, #24292e);
  font-size: 1.25rem;
  font-weight: 600;
}

.comments-title i {
  color: var(--primary-color, #0366d6);
}

.comments-description {
  margin-bottom: 1.5rem;
  padding: 1rem;
  background: var(--bg-primary, #ffffff);
  border-radius: var(--radius-lg, 8px);
  border-left: 4px solid var(--primary-color, #0366d6);
}

.comments-description p {
  margin: 0;
  color: var(--text-secondary, #586069);
  font-size: 0.9rem;
  line-height: 1.5;
}

#utterances-container,
#giscus-container {
  margin-top: 1rem;
}

/* è¯„è®ºç³»ç»Ÿåˆ‡æ¢æŒ‰é’® */
.comment-system-toggle {
  display: flex;
  gap: 0.5rem;
  margin-bottom: 1rem;
  padding: 0.5rem;
  background: var(--bg-primary, #ffffff);
  border-radius: var(--radius-lg, 8px);
  border: 1px solid var(--border-color, #e1e4e8);
}

.comment-toggle-btn {
  flex: 1;
  padding: 0.5rem 1rem;
  background: transparent;
  border: none;
  border-radius: var(--radius-md, 6px);
  color: var(--text-secondary, #586069);
  font-size: 0.85rem;
  cursor: pointer;
  transition: all var(--transition-fast, 0.15s ease);
}

.comment-toggle-btn.active {
  background: var(--primary-color, #0366d6);
  color: var(--text-inverse, #ffffff);
}

.comment-toggle-btn:hover:not(.active) {
  background: var(--bg-secondary, #f6f8fa);
  color: var(--text-primary, #24292e);
}

@media (max-width: 768px) {
  .doc-container {
    flex-direction: column;
  }
  
  .doc-sidebar {
    width: 100%;
    position: static;
  }
}
</style>

<script>
// ç”Ÿæˆç›®å½•
document.addEventListener('DOMContentLoaded', function() {
  const toc = document.getElementById('toc');
  const headings = document.querySelectorAll('.doc-body h2, .doc-body h3, .doc-body h4');
  
  if (headings.length > 0) {
    const tocList = document.createElement('ul');
    
    headings.forEach(function(heading, index) {
      const id = 'heading-' + index;
      heading.id = id;
      
      const li = document.createElement('li');
      const a = document.createElement('a');
      a.href = '#' + id;
      a.textContent = heading.textContent;
      a.className = 'toc-link toc-' + heading.tagName.toLowerCase();
      
      li.appendChild(a);
      tocList.appendChild(li);
    });
    
    toc.appendChild(tocList);
  }
});

// è¯„è®ºç³»ç»Ÿåˆ‡æ¢åŠŸèƒ½
function switchCommentSystem(system) {
  const utterancesContainer = document.getElementById('utterances-container');
  const giscusContainer = document.getElementById('giscus-container');
  
  if (system === 'giscus') {
    utterancesContainer.style.display = 'none';
    giscusContainer.style.display = 'block';
  } else {
    utterancesContainer.style.display = 'block';
    giscusContainer.style.display = 'none';
  }
}
</script>
  </main>

  <!-- è¿”å›é¡¶éƒ¨æŒ‰é’® -->
  <button id="back-to-top" class="back-to-top" title="è¿”å›é¡¶éƒ¨">
    <i class="fas fa-chevron-up"></i>
  </button>

  <!-- é¡µè„š -->
  <footer class="footer">
    <div class="footer-container">
      <div class="footer-content">
        <div class="footer-section">
          <h3>PythonçŸ¥è¯†ä½“ç³»æ–‡æ¡£</h3>
          <p>ç³»ç»ŸåŒ–æ•´ç†PythonçŸ¥è¯†ä½“ç³»çš„å¼€æºé¡¹ç›®</p>
        </div>
        <div class="footer-section">
          <h4>å¿«é€Ÿé“¾æ¥</h4>
          <ul>
            <li><a href="/PythonModelBook/docs/basics/">åŸºç¡€è¯­æ³•</a></li>
            <li><a href="/PythonModelBook/docs/builtins/">å†…ç½®å‡½æ•°</a></li>
            <li><a href="/PythonModelBook/docs/stdlib/">æ ‡å‡†åº“</a></li>
            <li><a href="/PythonModelBook/docs/thirdparty/">ç¬¬ä¸‰æ–¹åº“</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h4>ç¤¾åŒº</h4>
          <ul>
            <li><a href="https://github.com/liberalchang/PythonModelBook" target="_blank">GitHub</a></li>
            <li><a href="/PythonModelBook/CONTRIBUTING/">è´¡çŒ®æŒ‡å—</a></li>
            <li><a href="/PythonModelBook/about/">å…³äºé¡¹ç›®</a></li>
          </ul>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2025 PythonçŸ¥è¯†ä½“ç³»æ–‡æ¡£. é‡‡ç”¨ <a href="/PythonModelBook/LICENSE">MIT License</a> å¼€æºåè®®.</p>
      </div>
    </div>
  </footer>

  <!-- JavaScript -->
  <script src="/PythonModelBook/assets/js/main.js"></script>
  <script src="/PythonModelBook/assets/js/search.js"></script>
  
</body>

</html>